import{r as l,j as e,N as G,O as re,u as ue,b as K,c as Ce,a as R,A as Ie,R as Oe,d as C,e as me}from"./index-B0nHx2Rg.js";import{a as B}from"./index-t--hEgTQ.js";/* empty css            */import Ee from"./EditProfile-DZwd8u7p.js";/* empty css              */import{F as J,b as ne,c as ie,d as xe,e as pe}from"./index-BLsDSmvk.js";import{u as le}from"./auth-Dms_pdRh.js";import{S as ae}from"./react-select.esm-CEyevdAn.js";const Pe=({userId:m,token:d})=>{const[_,v]=l.useState([]),[j,c]=l.useState([]),[a,r]=l.useState([]),i=new Date;new Date(i).setDate(i.getDate()+21);const u=l.useCallback(async()=>{try{const x=await B.get(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${m}/intervals`,{headers:{Authorization:`Bearer ${d}`}});x.data?(v(x.data.intervals),c(x.data.bookings)):console.warn("Интервалы отсутствуют в ответе",x.data)}catch(x){console.error("Ошибка при получении интервалов:",x)}},[m,d]);return l.useEffect(()=>{m&&d&&u()},[m,d,u]),e.jsxs("div",{className:"account-content",children:[e.jsx("nav",{className:"nav","aria-label":"Меню управления интервалами",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(G,{to:"",end:!0,className:({isActive:x})=>x?"nav-link active":"nav-link","aria-current":({isActive:x})=>x?"page":null,children:"Список интервалов"})}),e.jsx("li",{children:e.jsx(G,{to:"new-interval",className:({isActive:x})=>x?"nav-link active":"nav-link","aria-current":({isActive:x})=>x?"page":null,children:"Добавить новый интервал"})})]})}),e.jsx("main",{className:"content",role:"main",children:e.jsx(re,{context:{userId:m,token:d,intervals:_,setIntervals:v,fetchIntervals:u,selectedDates:a,setSelectedDates:r}})})]})},qe=({userId:m,token:d})=>{const[_,v]=l.useState([]),j=l.useCallback(async()=>{try{const c=await B.get(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${m}/bookings`,{headers:{Authorization:`Bearer ${d}`}});v(c.data),console.error(c.data)}catch(c){console.error("Ошибка при получении бронирований:",c)}},[m,d]);return l.useEffect(()=>{j()},[j]),e.jsxs("div",{className:"account-content",children:[e.jsx("nav",{className:"nav","aria-label":"Меню бронирований",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(G,{to:"upcoming",className:({isActive:c})=>c?"nav-link active":"nav-link","aria-current":({isActive:c})=>c?"page":null,children:"Актуальные бронирования"})}),e.jsx("li",{children:e.jsx(G,{to:"past",className:({isActive:c})=>c?"nav-link active":"nav-link","aria-current":({isActive:c})=>c?"page":null,children:"Прошедшие бронирования"})})]})}),e.jsx("main",{className:"content",role:"main",children:e.jsx(re,{context:{bookings:_}})})]})},Fe=({userId:m,token:d})=>{const[_,v]=l.useState([]),[j,c]=l.useState(null),a=ue(),r=t=>{c(t),a(`/adminAccount/${m}/discountsManager/new-discount`,{state:{discount:t},replace:!0})};l.useEffect(()=>{(async()=>{await new Promise(u=>setTimeout(u,1e3))})()},[]),l.useEffect(()=>{i()},[]);const i=async()=>{try{const t=await B.get(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${m}/discounts/active`,{headers:{Authorization:`Bearer ${d}`}});v(t.data)}catch(t){console.error("Ошибка при загрузке скидок:",t)}};return e.jsxs("div",{className:"account-content",children:[e.jsx("nav",{className:"nav","aria-label":"Меню управления скидками",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(G,{to:"new-discount",className:({isActive:t})=>t?"nav-link active":"nav-link","aria-current":({isActive:t})=>t?"page":null,children:"Управление акциями"})}),e.jsx("li",{children:e.jsx(G,{to:"discount-list",className:({isActive:t})=>t?"nav-link active":"nav-link","aria-current":({isActive:t})=>t?"page":null,children:"Список акций"})})]})}),e.jsx("main",{className:"content",role:"main",children:e.jsx(re,{context:{discounts:_,setDiscounts:v,currentDiscount:j,setCurrentDiscount:c,fetchActiveDiscounts:i,userId:m,token:d,handleEditDiscount:r}})})]})};function Me(){const{bookings:m}=K(),d=new Date,_=m.filter(t=>{const u=new Date(t.booking_date),x=new Date(t.start_time);return u>d||u.toDateString()===d.toDateString()&&x>=d}),[v,j]=l.useState(""),[c,a]=l.useState("asc"),r=t=>{v===t?a(c==="asc"?"desc":"asc"):(j(t),a("asc"))},i=[..._].sort((t,u)=>{let x=0;switch(v){case"time":x=new Date(t.start_time)-new Date(u.start_time);break;case"price":x=t.price-u.price;break;case"name":const D=`${t.first_name} ${t.last_name}`.toLowerCase(),S=`${u.first_name} ${u.last_name}`.toLowerCase();x=D.localeCompare(S);break;default:return 0}return c==="asc"?x:-x});return e.jsx("div",{className:"table-container",children:i.length>0?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsxs("th",{onClick:()=>r("name"),className:"sortable",children:["Гость",e.jsx(J,{icon:v==="name"&&c==="asc"?ne:ie,className:"sort-icon"})]}),e.jsx("th",{children:"Тип гостя"}),e.jsxs("th",{onClick:()=>r("time"),className:"sortable",children:["Дата",e.jsx(J,{icon:v==="time"&&c==="asc"?ne:ie,className:"sort-icon"})]}),e.jsx("th",{children:"Начало"}),e.jsx("th",{children:"Конец"}),e.jsx("th",{children:"Веники"}),e.jsx("th",{children:"Полотенца"}),e.jsx("th",{children:"Шапки"}),e.jsx("th",{children:"Простыни"}),e.jsxs("th",{onClick:()=>r("price"),className:"sortable",children:["Цена",e.jsx(J,{icon:v==="price"&&c==="asc"?ne:ie,className:"sort-icon"})]}),e.jsx("th",{children:"Акция"})]})}),e.jsx("tbody",{children:i.map(t=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"ID",children:t.booking_id}),e.jsx("td",{"data-label":"Гость",children:t.first_name&&t.last_name?`${t.first_name} ${t.last_name}`:"Гость удален"}),e.jsx("td",{"data-label":"Тип гостя",children:t.user_type}),e.jsx("td",{"data-label":"Дата",children:new Date(t.booking_date).toLocaleDateString("ru-RU")}),e.jsx("td",{"data-label":"Начало",children:new Date(t.start_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Конец",children:new Date(t.end_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Веники",children:t.broom?t.broom_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Полотенца",children:t.towel?t.towel_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Шапки",children:t.hat?t.hat_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Простыни",children:t.sheets?t.sheets_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsxs("td",{"data-label":"Цена",children:[t.price," ₽"]}),e.jsx("td",{"data-label":"Акция",children:t.discount_status})]},t.booking_id))})]}):e.jsx("div",{className:"empty-container",children:e.jsx("p",{className:"empty-list",children:"Бронирований нет."})})})}function Be(){const{bookings:m}=K(),[d,_]=l.useState(""),[v,j]=l.useState([]);l.useEffect(()=>{const i=new Set(m.map(t=>t.user_type));j(Array.from(i))},[m]);const c=new Date,a=m.filter(i=>{const t=new Date(i.booking_date),u=new Date(i.start_time);return t<c||t.toDateString()===c.toDateString()&&u<c}),r=d?a.filter(i=>i.user_type===d):a;return e.jsx("div",{className:"table-container",children:r.length>0?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Гость"}),e.jsx("th",{children:"Тип гостя"}),e.jsx("th",{children:"Дата"}),e.jsx("th",{children:"Начало"}),e.jsx("th",{children:"Конец"}),e.jsx("th",{children:"Веники"}),e.jsx("th",{children:"Полотенца"}),e.jsx("th",{children:"Шапки"}),e.jsx("th",{children:"Простыни"}),e.jsx("th",{children:"Цена"}),e.jsx("th",{children:"Акция"})]})}),e.jsx("tbody",{children:r.map(i=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"ID",children:i.booking_id}),e.jsx("td",{"data-label":"Гость",children:i.first_name&&i.last_name?`${i.first_name} ${i.last_name}`:"Гость удален"}),e.jsx("td",{"data-label":"Тип гостя",children:i.user_type}),e.jsx("td",{"data-label":"Дата",children:new Date(i.booking_date).toLocaleDateString("ru-RU")}),e.jsx("td",{"data-label":"Начало",children:new Date(i.start_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Конец",children:new Date(i.end_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Веники",children:i.broom?i.broom_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Полотенца",children:i.towel?i.towel_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Шапки",children:i.hat?i.hat_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Простыни",children:i.sheets?i.sheets_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsxs("td",{"data-label":"Цена",children:[i.price," ₽"]}),e.jsx("td",{"data-label":"Акция",children:i.discount_status})]},i.booking_id))})]}):e.jsx("div",{className:"empty-container",children:e.jsx("p",{className:"empty-list",children:"Бронирований нет."})})})}function Le(){const{userId:m,token:d,intervals:_,fetchIntervals:v,selectedDates:j}=K(),{message:c,showMessage:a,error:r,isVisible:i}=le(),[t,u]=l.useState(5),x=async p=>{if(!p){console.error("Необходимо передать корректный идентификатор интервала для удаления.");return}try{await B.delete(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${m}/intervals/${p}`,{headers:{Authorization:`Bearer ${d}`}}),a("Интервал успешно удален!"),v()}catch(g){console.error("Ошибка при удалении интервала:",g)}};l.useEffect(()=>{v()},[v,j]);const D=_.reduce((p,g)=>{const N=g.booking_date;return p[N]||(p[N]=[]),p[N].push(g),p},{}),S=()=>{u(p=>p+5)};return e.jsxs("div",{className:"table-container",children:[(c||r)&&e.jsx("p",{className:`auth-message ${r?"error":"success"} ${i?"fade-in":"fade-out"}`,role:"alert",children:c||r}),_.length>0?e.jsxs(e.Fragment,{children:[Object.keys(D).sort((p,g)=>new Date(p)-new Date(g)).slice(0,t).map(p=>{const g=new Date(p).toLocaleDateString("ru-RU"),N=D[p].sort((w,I)=>{const P=new Date(`1970-01-01T${w.start_time}:00`),q=new Date(`1970-01-01T${I.start_time}:00`);return P-q});return e.jsxs("div",{className:"table-date",children:[e.jsx("p",{children:g}),e.jsxs("table",{className:"table-interval",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Начало интервала"}),e.jsx("th",{children:"Конец интервала"}),e.jsx("th",{children:"Действия"})]})}),e.jsx("tbody",{children:N.map(w=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Начало интервала",children:w.start_time}),e.jsx("td",{"data-label":"Конец интервала",children:w.end_time}),e.jsx("td",{"data-label":"Действия",children:e.jsx("button",{onClick:()=>x(w.id),className:"table-button",children:"Удалить"})})]},w.id))})]})]},p)}),Object.keys(D).length>t&&e.jsx("button",{onClick:S,className:"load-more",children:"Загрузить еще"})]}):e.jsx("div",{className:"empty-container",children:e.jsx("p",{className:"empty-list",children:"Интервалов нет."})})]})}function Re({setBookingDateStart:m,setBookingDateEnd:d,setSelectedDates:_,selectedDates:v,intervals:j,bookings:c,bookingDateStart:a,bookingDateEnd:r,dateSelectionMethod:i}){const[t,u]=l.useState(new Date),[x,D]=l.useState(null),S=n=>{const b=n.getFullYear(),k=String(n.getMonth()+1).padStart(2,"0"),T=String(n.getDate()).padStart(2,"0");return`${b}-${k}-${T}`},p=new Date;p.setHours(0,0,0,0);const g=t.getFullYear(),N=t.getMonth(),w=[],I=new Date(g,N,1),P=Array.from({length:new Date(g,N+1,0).getDate()},(n,b)=>new Date(g,N,b+1)),V=(I.getDay()+6)%7;for(let n=0;n<V;n++)w.push(e.jsx("div",{"aria-hidden":"true",role:"presentation",tabIndex:"-1"},`empty-${n}`));const L=n=>{i==="range"?x?n===a?(_([]),D(null),m(""),d("")):(d(n),_(b=>{const k=new Date(a),T=new Date(n),f=[];for(let $=k;$<=T;$.setDate($.getDate()+1))f.push(S(new Date($)));return[...new Set([...b,...f])]}),D(null)):(D(n),m(n)):(_(b=>b.includes(n)?b.filter(k=>k!==n):[...b,n]),m(b=>b===n?"":n))};P.forEach(n=>{const b=S(n),T=new Date(n.setHours(0,0,0,0))<p,f=v.includes(b),$=c.some(Z=>Z.booking_date===b),A=j.some(Z=>Z.booking_date===b),M=new Date(a),U=new Date(r),H=i==="range"&&n>=M&&n<=U,X=!A&&!T,ee=b===a;let E="calendar_day";T&&(E+=" past"),(f||ee)&&(E+=" selected"),H&&(E+=" range"),A&&(E+=" interval"),$&&(E+=" booking"),X&&(E+=" no-interval"),w.push(e.jsx("div",{className:E,onClick:()=>{T||L(b)},role:"gridcell","aria-selected":!!f,"aria-current":f||ee?"date":void 0,"aria-label":`${n.toLocaleString("ru-RU",{weekday:"long"})}, ${n.getDate()} ${n.toLocaleString("ru-RU",{month:"long"})} ${n.getFullYear()}`,tabIndex:T?"-1":"0",children:n.getDate()},`day-${b}`))});const O=(7-new Date(g,N+1,0).getDay())%7;for(let n=0;n<O;n++)w.push(e.jsx("div",{"aria-hidden":"true",role:"presentation",tabIndex:"-1"},`empty-after-${n}`));const Y=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];return e.jsxs("div",{className:"calendar_container",role:"application",children:[e.jsxs("div",{className:"calendar_header",children:[e.jsx("button",{onClick:()=>u(new Date(g,N-1,1)),type:"button",className:"arrow-button","aria-label":"Предыдущий месяц",children:e.jsx(J,{icon:xe})}),e.jsx("span",{style:{textAlign:"center"},children:`${Y[N]} ${g}`}),e.jsx("button",{onClick:()=>u(new Date(g,N+1,1)),type:"button",className:"arrow-button","aria-label":"Следующий месяц",children:e.jsx(J,{icon:pe})})]}),e.jsxs("div",{className:"calendar",role:"grid",children:[["ПН","ВТ","СР","ЧТ","ПТ","СБ","ВС"].map((n,b)=>e.jsx("div",{style:{textAlign:"center"},role:"columnheader",children:n},b)),w]})]})}function Ue(){const{userId:m,token:d,intervals:_,setIntervals:v,selectedDates:j,setSelectedDates:c}=K(),[a,r]=l.useState(""),[i,t]=l.useState(""),[u,x]=l.useState([]),[D,S]=l.useState(""),[p,g]=l.useState(""),[N,w]=l.useState("individual"),I=u.map(n=>({value:n.start_time.slice(0,5),label:n.start_time.slice(0,5)})),P=u.map(n=>({value:n.end_time.slice(0,5),label:n.end_time.slice(0,5)})),{message:q,showMessage:V,error:L,showError:F,isVisible:Q}=le(),O=async()=>{try{const n=await B.get(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${m}/availableIntervals/${a}`,{headers:{Authorization:`Bearer ${d}`}});n.data.intervals&&n.data.intervals.length>0?x(n.data.intervals):x([]),S(""),g("")}catch{F("Ошибка при получении доступных интервалов.")}};l.useEffect(()=>{a&&O()},[a,m]);const Y=async()=>{try{if(!a&&N==="range"||!j.length&&N==="individual"||!D||!p)throw F("Пожалуйста, выберите хотя бы одну дату и заполните все поля интервала."),new Error("Пожалуйста, выберите хотя бы одну дату и заполните все поля интервала.");const n=[];if(N==="range"){const f=new Date(a),$=new Date(i);for(let A=f;A<=$;A.setDate(A.getDate()+1)){const M=new Date(A),U=new Date(`${M.toISOString().split("T")[0]}T${D}`);if(new Date(`${M.toISOString().split("T")[0]}T${p}`)<=U)throw F("Время окончания должно быть после времени начала."),new Error("Время окончания должно быть после времени начала.");n.push({booking_date:M.toISOString().split("T")[0],start_time:D,end_time:p})}}else j.forEach(f=>{const $=new Date(f),A=new Date(`${$.toISOString().split("T")[0]}T${D}`);if(new Date(`${$.toISOString().split("T")[0]}T${p}`)<=A)throw F("Время окончания должно быть после времени начала."),new Error("Время окончания должно быть после времени начала.");n.push({booking_date:$.toISOString().split("T")[0],start_time:D,end_time:p})});const k=(await Promise.all(n.map(f=>B.post(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${m}/intervals`,f,{headers:{Authorization:`Bearer ${d}`}})))).map(f=>f.data.interval?{id:f.data.id,booking_date:f.data.interval.booking_date,start_time:f.data.interval.start_time,end_time:f.data.interval.end_time}:null).filter(f=>f!==null);v(f=>[...f,...k]),S(""),g(""),r(""),t("");const T=n.length===1?"Интервал успешно добавлен!":"Интервалы успешно добавлены!";V(T),c([])}catch(n){let b=n.message;n.response&&(b=n.response.data.error||n.response.data.message||"Произошла непредвиденная ошибка."),F(`Ошибка при добавлении интервала: ${b}`)}};return e.jsxs("div",{className:"account-form",children:[(q||L)&&e.jsx("p",{className:`auth-message ${L?"error":"success"} ${Q?"fade-in":"fade-out"}`,role:"alert",children:q||L}),e.jsxs("div",{className:"form-wrapper",children:[e.jsxs("div",{className:"calendar-container",children:[e.jsxs("label",{className:"form-label date-selection-method",children:[e.jsx("span",{className:"text-secondary",children:"Выбрать "}),e.jsx("button",{type:"button",className:`mode-btn ${N==="individual"?"selected":""}`,onClick:()=>w("individual"),children:"отдельные даты"}),e.jsx("span",{className:"text-secondary",children:" / "}),e.jsx("button",{type:"button",className:`mode-btn ${N==="range"?"selected":""}`,onClick:()=>w("range"),children:"диапазон дат"})]}),e.jsx(Re,{setBookingDateStart:r,setBookingDateEnd:t,setSelectedDates:c,selectedDates:j,bookings:[],intervals:_,bookingDateStart:a,bookingDateEnd:i,dateSelectionMethod:N})]}),e.jsxs("div",{className:"time-controls",children:[e.jsxs("div",{className:"time-select",children:[e.jsx("label",{htmlFor:"startTime",className:"form-label",children:"Время начала:"}),e.jsx(ae,{id:"startTime",value:D?{value:D,label:D}:null,onChange:n=>S(n.value),options:I,classNamePrefix:"time-select",placeholder:"Выбрать время",isDisabled:I.length===0})]}),e.jsxs("div",{className:"time-select",children:[e.jsx("label",{htmlFor:"endTime",className:"form-label",children:"Время окончания:"}),e.jsx(ae,{id:"endTime",value:p?{value:p,label:p}:null,onChange:n=>g(n.value),options:P,classNamePrefix:"time-select",placeholder:"Выбрать время",isDisabled:P.length===0})]}),e.jsx("button",{onClick:Y,className:"form-button",disabled:j.length===0||!D||!p,children:"Добавить интервал"})]})]})]})}function ze(){const{discounts:m,setDiscounts:d,handleEditDiscount:_,userId:v,token:j}=K(),c=async a=>{try{const r=await B.delete(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${v}/discounts/${a}`,{headers:{Authorization:`Bearer ${j}`}});r.status===200||r.status===204?d(m.filter(i=>i.id!==a)):alert("Ошибка при удалении акции")}catch(r){console.error("Ошибка при удалении акции:",r),alert("Ошибка при удалении акции")}};return e.jsx(e.Fragment,{children:m.length>0?e.jsx("div",{className:"discount-card-container",children:m.map(a=>e.jsxs("div",{className:"discount-card",children:[e.jsx("div",{className:"discount-header",children:e.jsxs("h4",{children:["Акция №",a.id]})}),e.jsxs("div",{className:"discount-content",children:[e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Описание акции:"})," ",e.jsx("span",{children:a.description})]}),a.time_discount_type==="no-time_limit"&&e.jsx("p",{className:"discount-info",children:"Действует постоянно"}),e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Действует"})," ",e.jsxs("span",{children:["c ",a.valid_from," до ",a.valid_till==="24:00"?"00:00":a.valid_till]})]}),a.applicable_days.length>0&&e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Применимо в дни:"}),e.jsx("span",{children:a.applicable_days.map(r=>e.jsxs("span",{children:[new Date(r).toLocaleDateString("ru-RU"),", "]},r))})]}),e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Тип скидки:"})," ",e.jsx("span",{children:a.discount_type==="discount"?"Скидка на стоимость":a.discount_type==="discount_service"?"Скидка на стоимость доп. услуги":"Бесплатные услуги"})]}),a.discount_percentage&&e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Процент скидки:"})," ",e.jsxs("span",{children:[a.discount_percentage,"%"]})]}),a.applicable_services.length>0&&e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Применимо к услугам:"}),e.jsx("span",{children:a.applicable_services.map(r=>{switch(r){case"broom":return"Веники";case"towel":return"Полотенца";case"hat":return"Шапки";case"sheets":return"Простыни";default:return r}}).join(", ")})]}),a.discount_type==="discount_service"&&a.service_prices&&e.jsx(e.Fragment,{children:a.applicable_services.map(r=>{const i=a.service_prices[r];return i!==void 0?e.jsxs("p",{className:"discount-info",children:[e.jsxs("span",{children:["Новая стоимость для ",r==="broom"?"веника":r==="towel"?"полотенца":r==="hat"?"шапки":r==="sheets"?"простыни":r,":"]})," ",e.jsxs("span",{children:[i," руб."]})]},r):null})}),a.discount_type==="free"&&a.free_service_counts&&e.jsx(e.Fragment,{children:Object.entries(a.free_service_counts).map(([r,i])=>{var t;if(i>0){let u;switch(r){case"broom":u=i===1?"веник":"веника";break;case"towel":u=i===1?"полотенце":"полотенца";break;case"hat":u=i===1?"шапка":"шапки";break;case"sheets":u=i===1?"простыня":"простыни";break;default:u=r}const x=((t=a.min_service_counts)==null?void 0:t[r])||0;return e.jsxs("p",{className:"discount-info",children:["За ",x," ",r==="broom"?"веника":r==="towel"?"полотенца":r==="hat"?"шапки":r==="sheets"?"простыни":r," ",i," ",u," в подарок"]},r)}return null})}),e.jsxs("div",{className:"actions-buttons",children:[e.jsx("button",{onClick:()=>c(a.id),className:"auth-button",children:"Удалить"}),e.jsx("p",{className:"auth-cancel",onClick:()=>_(a),children:"Редактировать"})]})]})]},a.id))}):e.jsx("div",{className:"empty-container",children:e.jsx("p",{className:"empty-list",children:"Акций нет."})})})}function We(){const{discounts:m,setCurrentDiscount:d,fetchActiveDiscounts:_,userId:v,token:j}=K(),c=Ce(),a=l.useMemo(()=>{var s;return((s=c.state)==null?void 0:s.discount)||{}},[c.state]),[r,i]=l.useState(a.description||""),[t,u]=l.useState(a.discount_type||"discount"),[x,D]=l.useState(a.applicable_services||[]),[S,p]=l.useState(a.service_prices||{broom:150,towel:200,hat:50,sheets:200}),[g,N]=l.useState(a.free_service_counts||{broom:0,towel:0,hat:0,sheets:0}),[w,I]=l.useState(a.min_service_counts||{broom:0,towel:0,hat:0,sheets:0}),[P,q]=l.useState(a.additional_services||{broom:{selected:!1,quantity:0},towel:{selected:!1,quantity:0},hat:{selected:!1,quantity:0},sheets:{selected:!1,quantity:0}}),[V,L]=l.useState(a.applicable_days||[]),[F,Q]=l.useState(new Date),[O,Y]=l.useState(a.valid_from||""),[n,b]=l.useState(a.valid_till||""),[k,T]=l.useState(a.discount_percentage||0),[f,$]=l.useState(a.time_discount_type||"no_time_limit"),A=Array.from({length:15},(s,o)=>{const h=(8+o).toString().padStart(2,"0")+":00";return{value:h,label:h}}),{message:M,showMessage:U,error:H,showError:X,isVisible:ee}=le(),E=Array.from({length:15},(s,o)=>{const h=(10+o).toString().padStart(2,"0")+":00";return{value:h,label:h}}),Z=(s,o)=>{const h=S[s];p(y=>({...y,[s]:o})),q(h!==o?y=>({...y,[s]:{...y[s],selected:!0}}):y=>({...y,[s]:{...y[s],selected:!1}}))},je=(s,o)=>{I(h=>({...h,[s]:o}))},ve=(s,o)=>{N(h=>({...h,[s]:o}))},ce=s=>{const o=s.getFullYear(),h=String(s.getMonth()+1).padStart(2,"0"),y=String(s.getDate()).padStart(2,"0");return`${o}-${h}-${y}`};l.useEffect(()=>{if(a.id){a.discount_type==="discount_service"?p(h=>{const y=a.service_prices||{};return JSON.stringify(h)!==JSON.stringify(y)?y:h}):a.discount_type==="free"&&(N(h=>{const y=a.free_service_counts||{};return JSON.stringify(h)!==JSON.stringify(y)?y:h}),I(h=>{const y=a.min_service_counts||{};return JSON.stringify(h)!==JSON.stringify(y)?y:h}));const s=a.applicable_services||[],o={};s.forEach(h=>{o[h]={selected:!0}}),q(h=>JSON.stringify(h)!==JSON.stringify(o)?o:h)}},[a]);const fe=s=>{const o=ce(s);L(h=>h.includes(o)?h.filter(y=>y!==o):[...h,o])},be=async s=>{try{return(await B.post(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${v}/discounts`,s,{headers:{Authorization:`Bearer ${j}`}})).data}catch{X("Возникла ошибка при создании скидки!")}},ge=async(s,o)=>{try{return(await B.put(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${v}/discounts/${s}`,o,{headers:{Authorization:`Bearer ${j}`}})).data}catch{X("Возникла ошибка при обновлении скидки!")}},ye=async s=>{s.preventDefault();const o={description:r,discountType:t,applicableDays:f==="time_limit"?V:[],validFrom:O,validTill:n,timeDiscountType:f,discountPercentage:t==="discount"?parseFloat(k):null,applicableServices:Object.keys(P).filter(h=>{var y;return(y=P[h])==null?void 0:y.selected}),servicePrices:t==="discount_service"?S:{},freeServiceCounts:t==="free"?g:{},minServiceCounts:t==="free"?w:{}};try{a.id?(await ge(a.id,o),U("Акция успешно обновлена!")):(await be(o),U("Акция успешно добавлена!")),_(),U(""),oe()}catch{X("Ошибка при добавлении или обновлении скидки. Попробуйте позже.")}},oe=()=>{i(""),L([]),Y(""),b(""),T(0),D([]),p({broom:150,towel:200,hat:50,sheets:200}),N({broom:0,towel:0,hat:0,sheets:0}),I({broom:0,towel:0,hat:0,sheets:0}),d(null)},z=F.getFullYear(),W=F.getMonth(),Ne=new Date(z,W,1),_e=Array.from({length:new Date(z,W+1,0).getDate()},(s,o)=>new Date(z,W,o+1)),de=new Date;de.setHours(0,0,0,0);const De=(Ne.getDay()+6)%7,we=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],te=[];for(let s=0;s<De;s++)te.push(e.jsx("div",{className:"empty-cell"},`empty-${s}`));_e.forEach(s=>{const o=ce(s),h=s<de,y=V.includes(o),he=m.some(Ae=>Ae.applicable_days.includes(o));let se="calendar_day";h&&(se+=" past"),y&&(se+=" selected"),he&&(se+=" discounted"),te.push(e.jsx("div",{className:se,onClick:()=>!h&&fe(s),children:s.getDate()},`day-${o}`))});const Se=(7-new Date(z,W+1,0).getDay())%7;for(let s=0;s<Se;s++)te.push(e.jsx("div",{},`empty-after-${s}`));const $e=r&&t&&O&&n&&((t==="discount"?k:!0)||(t==="discount_service"?Object.values(S).some(s=>s>0):!0)&&(t==="free"?Object.values(g).some(s=>s>0):!0)),ke=!r&&!O&&!n&&(!k||!Object.values(S).some(s=>s>0)||!Object.values(g).some(s=>s>0)),Te=s=>({broom:150,towel:200,hat:50,sheets:200})[s]||0;return e.jsxs("div",{className:"account-form",children:[(M||H)&&e.jsx("p",{className:`auth-message ${H?"error":"success"} ${ee?"fade-in":"fade-out"}`,role:"alert",children:M||H}),e.jsxs("form",{onSubmit:ye,children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Описание акции:"}),e.jsx("textarea",{value:r,onChange:s=>i(s.target.value),required:!0})]}),e.jsx("div",{className:"discount-label",children:e.jsxs("label",{className:"form-label",children:[e.jsx("span",{className:"text-secondary",children:"Тип акции по длительности: "}),e.jsx("button",{type:"button",className:`mode-btn ${f==="no_time_limit"?"selected":""}`,onClick:()=>$("no_time_limit"),children:"неограниченная акция"}),e.jsx("span",{className:"text-secondary",children:" / "}),e.jsx("button",{type:"button",className:`mode-btn ${f==="time_limit"?"selected":""}`,onClick:()=>$("time_limit"),children:"ограниченная акция"})]})}),e.jsxs("div",{className:"form-wrapper",children:[f==="time_limit"&&e.jsx("div",{className:"calendar-container",children:e.jsxs("div",{className:"calendar_container",children:[e.jsxs("div",{className:"calendar_header",children:[e.jsx("button",{onClick:()=>Q(new Date(z,W-1,1)),type:"button",className:"arrow-button",children:e.jsx(J,{icon:xe})})," ",e.jsx("span",{children:`${we[W]} ${z}`}),e.jsx("button",{onClick:()=>Q(new Date(z,W+1,1)),type:"button",className:"arrow-button",children:e.jsx(J,{icon:pe})})]}),e.jsxs("div",{className:"calendar",children:[["ПН","ВТ","СР","ЧТ","ПТ","СБ","ВС"].map((s,o)=>e.jsx("div",{style:{textAlign:"center",fontWeight:"bold"},children:s},o)),te]})]})}),e.jsxs("div",{className:`time-controls ${f!=="time_limit"?"align-left":""}`,children:[e.jsxs("label",{htmlFor:"startTime",className:"form-label",children:["Время начала:",e.jsx(ae,{id:"startTime",value:O?{value:O,label:O}:null,onChange:s=>Y(s.value),options:A,classNamePrefix:"time-select",placeholder:"Выберите время",isDisabled:A.length===0,required:!0})]}),e.jsx("br",{}),e.jsxs("label",{htmlFor:"endTime",className:"form-label",children:["Время окончания:",e.jsx(ae,{id:"endTime",value:n?{value:n,label:n}:null,onChange:s=>b(s.value),options:E,classNamePrefix:"time-select",placeholder:"Выберите время",isDisabled:E.length===0,required:!0})]})]})]}),e.jsx("div",{className:"discount-label",children:e.jsxs("label",{className:"form-label",children:[e.jsx("span",{className:"text-secondary",children:"Тип скидки: "}),e.jsx("button",{type:"button",className:`mode-btn ${t==="discount"?"selected":""}`,onClick:()=>u("discount"),children:"скидка на стоимость"}),e.jsx("span",{className:"text-secondary",children:" / "}),e.jsx("button",{type:"button",className:`mode-btn ${t==="discount_service"?"selected":""}`,onClick:()=>u("discount_service"),children:"скидка на доп. услугу"}),e.jsx("span",{className:"text-secondary",children:" / "}),e.jsx("button",{type:"button",className:`mode-btn ${t==="free"?"selected":""}`,onClick:()=>u("free"),children:"бесплатные услуги"})]})}),e.jsx("div",{className:"discount-container",children:e.jsxs("div",{className:"additional-services",children:[t==="discount"&&e.jsx("div",{children:e.jsxs("label",{className:"service-item perсentage-discount",children:[e.jsx("span",{children:"Процент скидки:"}),e.jsx("div",{className:"service-quantity",children:e.jsx("input",{type:"number",value:k,onChange:s=>T(s.target.value),min:"0",max:"100",required:!0,className:"service-quantity-input"})})]})}),t&&t!=="discount"&&e.jsx(e.Fragment,{children:["broom","towel","hat","sheets"].map(s=>e.jsxs("div",{children:[t==="discount_service"&&e.jsxs("label",{className:"service-item",children:[e.jsxs("span",{children:[s==="broom"?"Веник":s==="towel"?"Полотенце":s==="hat"?"Шапка":"Простыня","(изначальная цена ",Te(s)," ₽)"]}),e.jsx("div",{className:"service-quantity",children:e.jsx("input",{min:"0",type:"number",value:S[s]||"",onChange:o=>Z(s,o.target.value),className:"service-quantity-input"})})]}),t==="free"&&e.jsx("label",{className:"service-item",children:e.jsxs("div",{className:"free-service-item",children:[e.jsx("span",{children:s==="broom"?"Веник":s==="towel"?"Полотенце":s==="hat"?"Шапка":"Простыня"}),e.jsxs("div",{className:"free-service-quantity",children:[e.jsx("label",{children:"Минимальное количество для бесплатной услуги:"}),e.jsx("div",{className:"service-quantity",children:e.jsx("input",{type:"number",value:w[s]||"",onChange:o=>je(s,o.target.value),className:"service-quantity-input",min:"0",step:"1"})})]}),e.jsxs("div",{className:"free-service-quantity",children:[e.jsx("label",{children:"Количество бесплатных услуг:"}),e.jsx("div",{className:"service-quantity",children:e.jsx("input",{type:"number",value:g[s]||"",onChange:o=>ve(s,o.target.value),className:"service-quantity-input",min:"0",step:"1"})})]})]})})]},s))})]})}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:!$e,className:"form-button",children:a.id?"Сохранить изменения":"Добавить акцию"})}),!ke&&e.jsx("div",{children:e.jsx("p",{className:"auth-cancel",onClick:oe,children:"Отменить изменения"})})]})]})}function tt(){const m=ue(),[d,_]=l.useState({firstName:R.get("firstName"),lastName:R.get("lastName"),userId:R.get("userId"),token:R.get("token")});l.useEffect(()=>{R.get("token")||m("/")},[m]);const v=j=>{_(c=>({...c,firstName:j.first_name,lastName:j.last_name,phoneNumber:j.phone_number})),R.set("firstName",j.first_name,{expires:7,secure:!0,sameSite:"Strict"}),R.set("lastName",j.last_name,{expires:7,secure:!0,sameSite:"Strict"}),R.set("phoneNumber",j.phone_number,{expires:7,secure:!0,sameSite:"Strict"})};return e.jsxs("div",{children:[e.jsx(Ie,{userId:d.userId}),e.jsx("div",{className:"account-container",children:e.jsxs(Oe,{children:[e.jsx(C,{path:"/",element:e.jsx(me,{to:"/"})}),e.jsxs(C,{path:"intervals",element:e.jsx(Pe,{userId:d.userId,token:d.token}),children:[e.jsx(C,{index:!0,element:e.jsx(Le,{})}),e.jsx(C,{path:"new-interval",element:e.jsx(Ue,{})})]}),e.jsxs(C,{path:"bookings",element:e.jsx(qe,{userId:d.userId,token:d.token}),children:[e.jsx(C,{path:"upcoming",element:e.jsx(Me,{})}),e.jsx(C,{path:"past",element:e.jsx(Be,{})})]}),e.jsxs(C,{path:"discountsManager",element:e.jsx(Fe,{userId:d.userId,token:d.token}),children:[e.jsx(C,{path:"new-discount",element:e.jsx(We,{})}),e.jsx(C,{path:"discount-list",element:e.jsx(ze,{})})]}),e.jsx(C,{path:"editProfile",element:e.jsx(Ee,{userId:d.userId,token:d.token,updateUserData:v})}),e.jsx(C,{path:"*",element:e.jsx(me,{to:`/adminAccount/${d.userId}/intervals`})})]})})]})}export{tt as default};
