import{b as C,r as b,j as e}from"./index-83Tp2EN1.js";import{a as A}from"./index-t--hEgTQ.js";/* empty css              */import{u as O}from"./auth-Be68LJyF.js";import{F as m,b as u,c as x}from"./index-BWBgj6Hi.js";function E(){const{bookings:g,setBookings:w,userId:_,token:D}=C(),{message:p,showMessage:f,error:i,showError:l,isVisible:N}=O(),o=new Date,[c,S]=b.useState(""),[r,j]=b.useState("asc"),k=g.filter(t=>{const s=new Date(t.booking_date),a=new Date(t.start_time);return s>o||s.toDateString()===o.toDateString()&&a>=o}),d=t=>{c===t?j(r==="asc"?"desc":"asc"):(S(t),j("asc"))},h=[...k].sort((t,s)=>{let a=0;switch(c){case"date":a=new Date(t.booking_date)-new Date(s.booking_date);break;case"price":a=t.price-s.price;break;case"discount":a=(t.discount_status?1:0)-(s.discount_status?1:0);break;default:return 0}return r==="asc"?a:-a}),y=async(t,s)=>{if(!t){l("ID бронирования не найден.");return}if(new Date(s)<o){l("Нельзя отменить бронь, так как дата уже наступила.");return}try{await A.delete(`http://api.dom-ban-na-drovah.ru/api/userAccount/${_}/bookings/${t}`,{headers:{Authorization:`Bearer ${D}`}}),w(n=>n.filter(B=>B.booking_id!==t)),f("Бронь успешно отменена.")}catch(n){console.error("Ошибка при отмене бронирования:",n.response||n.message),l("Не удалось отменить бронь.")}};return e.jsxs("div",{className:"table-container",children:[(p||i)&&h.length>0&&e.jsx("p",{className:`auth-message ${i?"error":"success"} ${N?"fade-in":"fade-out"}`,role:"alert",children:p||i}),h.length>0?e.jsxs("table",{className:"accessible-table",role:"grid","aria-labelledby":"upcoming-bookings-title",children:[e.jsx("caption",{id:"upcoming-bookings-title",children:"Предстоящие бронирования"}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{scope:"col",onClick:()=>d("date"),className:"sortable",children:["Дата",e.jsx(m,{icon:c==="date"&&r==="asc"?u:x,className:"sort-icon",title:"Сортируй по дате"})]}),e.jsx("th",{scope:"col",children:"Начало"}),e.jsx("th",{scope:"col",children:"Конец"}),e.jsx("th",{scope:"col",children:"Веники"}),e.jsx("th",{scope:"col",children:"Полотенца"}),e.jsx("th",{scope:"col",children:"Шапки"}),e.jsx("th",{scope:"col",children:"Простыни"}),e.jsxs("th",{scope:"col",onClick:()=>d("price"),className:"sortable",children:["Цена",e.jsx(m,{icon:c==="price"&&r==="asc"?u:x,className:"sort-icon",title:"Сортируй по цене"})]}),e.jsxs("th",{scope:"col",onClick:()=>d("discount"),className:"sortable",children:["Акция",e.jsx(m,{icon:c==="discount"&&r==="asc"?u:x,className:"sort-icon",title:"Сортируй по акции"})]}),e.jsx("th",{scope:"col",children:"Действия"})]})}),e.jsx("tbody",{children:h.map(t=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Дата",children:new Date(t.booking_date).toLocaleDateString("ru-RU")}),e.jsx("td",{"data-label":"Начало",children:new Date(t.start_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Конец",children:new Date(t.end_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Веники",children:t.broom?t.broom_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Полотенца",children:t.towel?t.towel_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Шапки",children:t.hat?t.hat_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Простыни",children:t.sheets?t.sheets_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsxs("td",{"data-label":"Цена",children:[t.price," ₽"]}),e.jsx("td",{"data-label":"Акция",children:t.discount_status}),e.jsx("td",{"data-label":"Действия",children:e.jsx("button",{onClick:()=>y(t.booking_id,t.booking_date),className:"table-button",children:"Отменить"})})]},t.booking_id))})]}):e.jsx("div",{className:"empty-container",children:e.jsx("p",{className:"empty-list",children:"Бронирований нет."})})]})}export{E as default};
