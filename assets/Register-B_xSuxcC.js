import{r as y,u as R,j as a,L as T,a as f}from"./index-D0TfeZVT.js";import{a as E}from"./index-t--hEgTQ.js";import{F as k,f as V,a as _,b as $}from"./index-BJefMmjJ.js";import{u as A}from"./auth-3PVLoRF3.js";/* empty css                        */const D=(r=!1)=>{const[l,t]=y.useState(r),o=()=>t(!l);return{type:l?"text":"password",icon:l?_:$,toggle:o,handleKeyDown:u=>{(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),o())},visible:l}};function G(){const[r,l]=y.useState({firstName:"",lastName:"",password:"",confirmPassword:"",phoneNumber:"",verificationCode:""}),[t,o]=y.useState({isCodeSent:!1,canResendCode:!0,isSubmitting:!1}),N=D(),u=D(),j=R(),{message:w,showMessage:F,error:g,showError:p,isVisible:P}=A(),q=e=>{const s=e.replace(/\D/g,"").slice(0,11);let i=s;return s.length>0&&(i="+7 (",s.length>1&&(i+=`${s.slice(1,4)}`),s.length>4&&(i+=`) ${s.slice(4,7)}`),s.length>7&&(i+=`-${s.slice(7,9)}`),s.length>9&&(i+=`-${s.slice(9)}`)),i},K=e=>{const n=e.target.value,s=r.phoneNumber;if(n.length<s.length){l(d=>({...d,phoneNumber:n}));return}const i=q(n);l(d=>({...d,phoneNumber:i}))},x=()=>{const e=r.phoneNumber.replace(/\D/g,"");return e.length===10?"7"+e:e},m=e=>{const{id:n,value:s}=e.target;n==="phoneNumber"?K(e):l(i=>({...i,[n]:s}))},c=async()=>{var e,n;o(s=>({...s,isSubmitting:!0}));try{const s=x();(await E.post("https://api.dom-ban-na-drovah.ru/api/register",{phone_number:s},{withCredentials:!0})).status===200&&(o({isCodeSent:!0,canResendCode:!1,isSubmitting:!1}),F("Код отправлен на Ваш номер телефона."),setTimeout(()=>o(d=>({...d,canResendCode:!0})),6e4))}catch(s){o(i=>({...i,isSubmitting:!1})),p(((n=(e=s.response)==null?void 0:e.data)==null?void 0:n.error)||"Ошибка отправки кода.")}},v=async()=>{var e,n;if(r.password!==r.confirmPassword){p("Пароли не совпадают!");return}o(s=>({...s,isSubmitting:!0}));try{const s=x(),i=await E.post("https://api.dom-ban-na-drovah.ru/api/verify-registration",{first_name:r.firstName,last_name:r.lastName,password:r.password,phone_number:s,verification_code:r.verificationCode},{withCredentials:!0});if(i.status===201){const{token:d,userId:S,first_name:X,last_name:I}=i.data;f.set("token",d,{expires:7,secure:!0}),f.set("userId",S,{expires:7,secure:!0}),f.set("firstName",X,{expires:7,secure:!0}),f.set("lastName",I,{expires:7,secure:!0}),j(`/userAccount/${S}`)}else p("Неизвестная ошибка сервера")}catch(s){s.code==="ECONNABORTED"?p("Сервер не отвечает. Попробуйте позже."):p(((n=(e=s.response)==null?void 0:e.data)==null?void 0:n.error)||"Ошибка регистрации. Проверьте данные.")}finally{o(s=>({...s,isSubmitting:!1}))}},h=r.firstName&&r.lastName&&r.password&&r.confirmPassword&&x().length>=11,L=r.verificationCode.length===4,b=(e,n)=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),n())},C=e=>a.jsx(k,{icon:e.icon,className:"passwordIcon",onClick:e.toggle,onKeyDown:e.handleKeyDown,tabIndex:"0",role:"button","aria-label":e.visible?"Скрыть пароль":"Показать пароль","aria-pressed":e.visible});return a.jsxs("div",{className:"auth-page auth-background",children:[a.jsx("header",{className:"auth-header",children:a.jsxs("button",{className:"back-button",onClick:()=>j("/"),"aria-label":"Вернуться на главную",children:[a.jsx(k,{icon:V}),a.jsx("span",{children:"На главную"})]})}),a.jsx("main",{className:"auth-container",role:"region","aria-labelledby":"registerTitle",children:a.jsx("div",{className:"auth-block reg",role:"group","aria-labelledby":"registerBlockLabel",children:a.jsxs("div",{className:"auth-content",children:[a.jsx("h1",{id:"registerTitle",className:"auth-title",children:"РЕГИСТРАЦИЯ"}),(w||g)&&a.jsx("p",{className:`auth-message ${g?"error":"success"} ${P?"fade-in":"fade-out"}`,role:"alert",children:w||g}),a.jsx("div",{className:"auth-form",children:a.jsxs("div",{className:"auth-row",children:[a.jsxs("div",{className:"auth-column",children:[a.jsxs("label",{className:"auth-label",htmlFor:"firstName",children:["Имя",a.jsx("input",{type:"text",id:"firstName",className:"auth-input",placeholder:"Введите имя",maxLength:20,onChange:e=>m(e),value:r.firstName,required:!0,"aria-required":"true","aria-describedby":"firstNameError"}),a.jsx("span",{id:"firstNameError",className:"screen-reader-only"})]}),a.jsxs("label",{className:"auth-label",htmlFor:"lastName",children:["Фамилия",a.jsx("input",{type:"text",id:"lastName",className:"auth-input",placeholder:"Введите фамилию",maxLength:20,onChange:e=>m(e),value:r.lastName,required:!0,"aria-required":"true","aria-describedby":"lastNameError"}),a.jsx("span",{id:"lastNameError",className:"screen-reader-only"})]})]}),a.jsxs("div",{className:"auth-column",children:[a.jsxs("label",{className:"auth-label",htmlFor:"password",children:["Пароль",a.jsxs("div",{className:"passwordInput",children:[a.jsx("input",{type:N.type,id:"password",className:"auth-input",placeholder:"Введите пароль",maxLength:16,onChange:e=>m(e),value:r.password,required:!0,"aria-required":"true","aria-describedby":"passwordError"}),C(N)]}),a.jsx("span",{id:"passwordError",className:"screen-reader-only"})]}),a.jsxs("label",{className:"auth-label",htmlFor:"confirmPassword",children:["Проверка пароля",a.jsxs("div",{className:"passwordInput",children:[a.jsx("input",{type:u.type,id:"confirmPassword",className:"auth-input",placeholder:"Повторите пароль",maxLength:16,onChange:e=>m(e),value:r.confirmPassword,required:!0,"aria-required":"true","aria-describedby":"confirmPasswordError"}),C(u)]}),a.jsx("span",{id:"confirmPasswordError",className:"screen-reader-only"})]})]}),a.jsxs("div",{className:"auth-column",children:[a.jsxs("label",{className:"auth-label",htmlFor:"phoneNumber",children:["Номер телефона",a.jsx("input",{type:"tel",id:"phoneNumber",className:"auth-input",placeholder:"+7 (XXX) XXX-XX-XX",maxLength:18,onChange:e=>m(e),value:r.phoneNumber,required:!0,"aria-required":"true","aria-describedby":"phoneNumberError"}),a.jsx("span",{id:"phoneNumberError",className:"screen-reader-only"})]}),h&&a.jsxs("label",{className:"auth-label",htmlFor:"verificationCode",children:["Код верификации",a.jsx("input",{type:"text",id:"verificationCode",className:"auth-input",placeholder:"Введите код",maxLength:4,onChange:e=>m(e),onKeyDown:e=>{e.key==="Enter"&&h&&!t.isCodeSent&&(e.preventDefault(),c())},value:r.verificationCode,required:!0,"aria-required":"true","aria-describedby":"verificationCodeError"}),a.jsx("span",{id:"verificationCodeError",className:"screen-reader-only"})]})]})]})}),!t.isCodeSent&&!h&&a.jsx("button",{className:"auth-button",onClick:c,onKeyDown:e=>b(e,c),disabled:!h||t.isSubmitting,"aria-busy":t.isSubmitting,"aria-live":"polite",children:"Зарегистрироваться"}),h&&!t.isCodeSent&&a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"auth-info",children:"На Ваш номер телефона поступит звонок, введите последние 4 цифры номера."}),a.jsx("button",{className:"auth-button",onClick:c,onKeyDown:e=>b(e,c),disabled:!h||t.isSubmitting,"aria-busy":t.isSubmitting,"aria-live":"polite",children:t.isSubmitting?"Отправка...":"Отправить код"})]}),t.isCodeSent&&a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"auth-button",onClick:v,onKeyDown:e=>b(e,v),disabled:!L||t.isSubmitting,"aria-busy":t.isSubmitting,"aria-live":"polite",children:t.isSubmitting?"Регистрация...":"Зарегистрироваться"}),t.canResendCode&&a.jsx("button",{className:"auth-button",onClick:c,onKeyDown:e=>b(e,c),disabled:t.isSubmitting,"aria-busy":t.isSubmitting,"aria-live":"polite",children:"Отправить код еще раз"})]}),a.jsx("div",{className:"auth-links",children:a.jsxs("p",{children:["Уже есть учетная запись?",a.jsx(T,{to:"/login",className:"auth-link",children:"Войдите"})]})})]})})})]})}export{G as default};
