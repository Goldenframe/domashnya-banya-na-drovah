import{r,u as J,j as e,L as O}from"./index-Yc38Jpbt.js";import{a as y}from"./index-t--hEgTQ.js";import{u as Q}from"./auth-DxSWj78Z.js";import{F as L,f as R,a as D}from"./index-B_uCmsTn.js";function Z(){const[h,P]=r.useState(""),[o,_]=r.useState(""),[m,$]=r.useState(!1),[t,T]=r.useState(""),[i,V]=r.useState(""),[c,q]=r.useState(!1),[K,C]=r.useState(null),[f,E]=r.useState(!1),[p,I]=r.useState(!1),{message:k,showMessage:N,error:v,showError:b,isVisible:M}=Q(),A=J(),g=r.useRef(null),w=r.useRef(null),d=r.useRef(null),B=r.useRef(null);r.useEffect(()=>{g.current&&!m&&!c&&g.current.focus()},[]),r.useEffect(()=>{m&&w.current?w.current.focus():c&&d.current&&d.current.focus()},[m,c]),r.useEffect(()=>{const s=n=>{n.key==="Enter"&&(!c&&!m&&u?j():!c&&m&&o?S():c&&t&&i&&F())};return document.addEventListener("keydown",s),()=>document.removeEventListener("keydown",s)});const z=s=>{const a=s.replace(/\D/g,"").slice(0,11);let l=a;return a.length>0&&(l="+7 (",a.length>1&&(l+=`${a.slice(1,4)}`),a.length>4&&(l+=`) ${a.slice(4,7)}`),a.length>7&&(l+=`-${a.slice(7,9)}`),a.length>9&&(l+=`-${a.slice(9)}`)),l},G=s=>{const n=s.target.value,a=h;if(n.length<a.length){P(n);return}const l=z(n);P(l)},x=()=>{const s=h.replace(/\D/g,"");return s.length===10?"7"+s:s},u=x().length===11,j=async()=>{var s,n;try{const a=await y.post("https://api.dom-ban-na-drovah.ru/api/forgot-password",{phone_number:x()});N(a.data.message),$(!0),C(setTimeout(()=>C(null),6e4))}catch(a){b(((n=(s=a.response)==null?void 0:s.data)==null?void 0:n.error)||"Ошибка отправки кода."),g.current&&g.current.focus()}},H=()=>{j()},S=async()=>{var s,n;try{(await y.post("https://api.dom-ban-na-drovah.ru/api/verify-code",{phone_number:x(),verification_code:o})).status===200&&(q(!0),N("Код подтверждения верен!"))}catch(a){b(((n=(s=a.response)==null?void 0:s.data)==null?void 0:n.error)||"Ошибка проверки кода."),w.current&&w.current.focus()}},F=async()=>{var s,n;if(t!==i){b("Пароли не совпадают!"),d.current&&d.current.focus();return}try{const a=await y.post("https://api.dom-ban-na-drovah.ru/api/reset-password",{phone_number:x(),verification_code:o,new_password:t});N(a.data.message),a.status===200&&A("/login")}catch(a){b(((n=(s=a.response)==null?void 0:s.data)==null?void 0:n.error)||"Ошибка восстановления пароля."),d.current&&d.current.focus()}};return e.jsx("main",{className:"auth-container",role:"main","aria-labelledby":"forgotPasswordTitle",children:e.jsx("div",{className:"auth-block forget",role:"group","aria-labelledby":"forgotPasswordBlockLabel",children:e.jsxs("div",{className:"auth-content",children:[e.jsx("h1",{id:"forgotPasswordTitle",className:"auth-title",children:"ВОССТАНОВЛЕНИЕ ПАРОЛЯ"}),(k||v)&&e.jsx("div",{className:`auth-message ${v?"error":"success"} ${M?"fade-in":"fade-out"}`,role:"alert","aria-live":"assertive",children:k||v}),e.jsx("form",{className:"auth-form",onSubmit:s=>s.preventDefault(),children:c?e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"auth-label",htmlFor:"newPasswordInput",children:["Новый пароль",e.jsxs("div",{className:"passwordInput",children:[e.jsx("input",{type:f?"text":"password",id:"newPasswordInput",className:"auth-input",value:t,onChange:s=>T(s.target.value),maxLength:16,minLength:8,"aria-required":"true","aria-invalid":t.length>0&&t.length<8,"aria-describedby":t.length>0&&t.length<8?"newPasswordError":void 0,ref:d}),e.jsx(L,{icon:f?R:D,className:"passwordIcon",onClick:()=>E(!f),"aria-label":f?"Скрыть пароль":"Показать пароль",tabIndex:"0",onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&E(!f)},role:"button","aria-pressed":f}),t.length>0&&t.length<8&&e.jsx("span",{id:"newPasswordError",className:"auth-error-message",children:"Пароль должен содержать не менее 8 символов"})]})]}),e.jsxs("label",{className:"auth-label",htmlFor:"confirmNewPasswordInput",children:["Подтвердите пароль",e.jsxs("div",{className:"passwordInput",children:[e.jsx("input",{type:p?"text":"password",id:"confirmNewPasswordInput",className:"auth-input",value:i,onChange:s=>V(s.target.value),maxLength:16,minLength:8,"aria-required":"true","aria-invalid":i.length>0&&i!==t,"aria-describedby":i.length>0&&i!==t?"confirmNewPasswordError":void 0,ref:B}),e.jsx(L,{icon:p?R:D,className:"passwordIcon",onClick:()=>I(!p),"aria-label":p?"Скрыть пароль":"Показать пароль",tabIndex:"0",onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&I(!p)},role:"button","aria-pressed":p}),i.length>0&&i!==t&&e.jsx("span",{id:"confirmNewPasswordError",className:"auth-error-message",children:"Пароли не совпадают"})]})]}),e.jsx("button",{className:"auth-button",onClick:F,disabled:!(t&&i&&t===i&&t.length>=8),"aria-disabled":!(t&&i&&t===i&&t.length>=8),children:"Сохранить пароль"})]}):m?e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"auth-label",htmlFor:"codeInput",children:["Код подтверждения",e.jsx("input",{type:"text",id:"codeInput",className:"auth-input",value:o,onChange:s=>_(s.target.value),maxLength:4,"aria-required":"true","aria-invalid":o.length>0&&o.length<4,"aria-describedby":o.length>0&&o.length<4?"codeError":void 0,ref:w}),o.length>0&&o.length<4&&e.jsx("span",{id:"codeError",className:"auth-error-message",children:"Код должен содержать 4 цифры"})]}),e.jsx("button",{className:"auth-button",onClick:S,disabled:o.length!==4,"aria-disabled":o.length!==4,children:o.length!==4?"Введите 4 цифры кода":"Подтвердить код"}),K===null&&e.jsx("button",{className:"auth-button secondary",onClick:H,children:"Отправить код снова"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"auth-label",htmlFor:"phoneInput",children:["Номер телефона",e.jsx("input",{type:"tel",id:"phoneInput",className:"auth-input",value:h,onChange:G,placeholder:"+7 (900) 000-00-00","aria-required":"true","aria-invalid":!u&&h.length>0,"aria-describedby":!u&&h.length>0?"phoneError":void 0,ref:g}),!u&&h.length>0&&e.jsx("span",{id:"phoneError",className:"auth-error-message",children:"Введите корректный номер телефона"})]}),e.jsx("p",{className:"auth-info",children:"На Ваш номер телефона поступит звонок, введите последние 4 цифры номера."}),e.jsx("button",{className:"auth-button",onClick:j,disabled:!u,"aria-disabled":!u,children:u?"Отправить код":"Введите номер телефона"})]})}),e.jsx("div",{className:"auth-links",children:e.jsxs("p",{children:["Уже есть учетная запись?"," ",e.jsx(O,{to:"/login",className:"auth-link",children:"Вернуться ко входу"})]})})]})})})}export{Z as default};
