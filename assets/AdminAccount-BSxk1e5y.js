import{r as l,j as e,N as G,O as re,u as xe,b as K,c as Ce,a as R,A as Ie,R as Oe,d as C,e as ue}from"./index-CicdnqK6.js";import{a as B}from"./index-t--hEgTQ.js";/* empty css            */import Ee from"./EditProfile-BGdVwZ9i.js";/* empty css              */import{F as J,b as ne,c as ie,d as je,e as pe}from"./index-yFapBldT.js";import{u as le}from"./auth-D2SRLsAp.js";import{S as ae}from"./react-select.esm-BXH2UJ-z.js";const Fe=({userId:h,token:o})=>{const[N,f]=l.useState([]),[j,m]=l.useState([]),[a,r]=l.useState([]),i=new Date;new Date(i).setDate(i.getDate()+21);const u=l.useCallback(async()=>{try{const v=await B.get(`/api/adminAccount/${h}/intervals`,{headers:{Authorization:`Bearer ${o}`}});v.data?(f(v.data.intervals),m(v.data.bookings)):console.warn("Интервалы отсутствуют в ответе",v.data)}catch(v){console.error("Ошибка при получении интервалов:",v)}},[h,o]);return l.useEffect(()=>{h&&o&&u()},[h,o,u]),e.jsxs("div",{className:"account-content",children:[e.jsxs("nav",{className:"nav",children:[e.jsx(G,{to:"",end:!0,className:({isActive:v})=>v?"nav-link active":"nav-link",children:"Список интервалов"}),e.jsx(G,{to:"new-interval",className:({isActive:v})=>v?"nav-link active":"nav-link",children:"Добавить новый интервал"})]}),e.jsx(re,{context:{userId:h,token:o,intervals:N,setIntervals:f,fetchIntervals:u,selectedDates:a,setSelectedDates:r}})]})},Pe=({userId:h,token:o})=>{const[N,f]=l.useState([]),j=l.useCallback(async()=>{try{const m=await B.get(`/api/adminAccount/${h}/bookings`,{headers:{Authorization:`Bearer ${o}`}});f(m.data),console.error(m.data)}catch(m){console.error("Ошибка при получении бронирований:",m)}},[h,o]);return l.useEffect(()=>{j()},[j]),e.jsxs("div",{className:"account-content",children:[e.jsxs("nav",{className:"nav",children:[e.jsx(G,{to:"upcoming",className:({isActive:m})=>m?"nav-link active":"nav-link",children:"Актуальные бронирования"}),e.jsx(G,{to:"past",className:({isActive:m})=>m?"nav-link active":"nav-link",children:"Прошедшие бронирования"})]}),e.jsx(re,{context:{bookings:N}})]})},qe=({userId:h,token:o})=>{const[N,f]=l.useState([]),[j,m]=l.useState(null),a=xe(),r=t=>{m(t),a(`/adminAccount/${h}/discountsManager/new-discount`,{state:{discount:t},replace:!0})};l.useEffect(()=>{(async()=>{await new Promise(u=>setTimeout(u,1e3))})()},[]),l.useEffect(()=>{i()},[]);const i=async()=>{try{const t=await B.get("/api/adminAccount/:userId/discounts/active",{headers:{Authorization:`Bearer ${o}`}});f(t.data)}catch(t){console.error("Ошибка при загрузке скидок:",t)}};return e.jsxs("div",{className:"account-content",children:[e.jsxs("nav",{className:"nav",children:[e.jsx(G,{to:"new-discount",className:({isActive:t})=>t?"nav-link active":"nav-link",children:"Управление акциями"}),e.jsx(G,{to:"discount-list",className:({isActive:t})=>t?"nav-link active":"nav-link",children:"Список акций"})]}),e.jsx(re,{context:{discounts:N,setDiscounts:f,currentDiscount:j,setCurrentDiscount:m,fetchActiveDiscounts:i,userId:h,token:o,handleEditDiscount:r}})]})};function Me(){const{bookings:h}=K(),o=new Date,N=h.filter(t=>{const u=new Date(t.booking_date),v=new Date(t.start_time);return u>o||u.toDateString()===o.toDateString()&&v>=o}),[f,j]=l.useState(""),[m,a]=l.useState("asc"),r=t=>{f===t?a(m==="asc"?"desc":"asc"):(j(t),a("asc"))},i=[...N].sort((t,u)=>{let v=0;switch(f){case"time":v=new Date(t.start_time)-new Date(u.start_time);break;case"price":v=t.price-u.price;break;case"name":const D=`${t.first_name} ${t.last_name}`.toLowerCase(),S=`${u.first_name} ${u.last_name}`.toLowerCase();v=D.localeCompare(S);break;default:return 0}return m==="asc"?v:-v});return e.jsx("div",{className:"table-container",children:i.length>0?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsxs("th",{onClick:()=>r("name"),className:"sortable",children:["Гость",e.jsx(J,{icon:f==="name"&&m==="asc"?ne:ie,className:"sort-icon"})]}),e.jsx("th",{children:"Тип гостя"}),e.jsxs("th",{onClick:()=>r("time"),className:"sortable",children:["Дата",e.jsx(J,{icon:f==="time"&&m==="asc"?ne:ie,className:"sort-icon"})]}),e.jsx("th",{children:"Начало"}),e.jsx("th",{children:"Конец"}),e.jsx("th",{children:"Веники"}),e.jsx("th",{children:"Полотенца"}),e.jsx("th",{children:"Шапки"}),e.jsx("th",{children:"Простыни"}),e.jsxs("th",{onClick:()=>r("price"),className:"sortable",children:["Цена",e.jsx(J,{icon:f==="price"&&m==="asc"?ne:ie,className:"sort-icon"})]}),e.jsx("th",{children:"Акция"})]})}),e.jsx("tbody",{children:i.map(t=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"ID",children:t.booking_id}),e.jsx("td",{"data-label":"Гость",children:t.first_name&&t.last_name?`${t.first_name} ${t.last_name}`:"Гость удален"}),e.jsx("td",{"data-label":"Тип гостя",children:t.user_type}),e.jsx("td",{"data-label":"Дата",children:new Date(t.booking_date).toLocaleDateString("ru-RU")}),e.jsx("td",{"data-label":"Начало",children:new Date(t.start_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Конец",children:new Date(t.end_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Веники",children:t.broom?t.broom_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Полотенца",children:t.towel?t.towel_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Шапки",children:t.hat?t.hat_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Простыни",children:t.sheets?t.sheets_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsxs("td",{"data-label":"Цена",children:[t.price," ₽"]}),e.jsx("td",{"data-label":"Акция",children:t.discount_status})]},t.booking_id))})]}):e.jsx("div",{className:"empty-container",children:e.jsx("p",{className:"empty-list",children:"Бронирований нет."})})})}function Be(){const{bookings:h}=K(),[o,N]=l.useState(""),[f,j]=l.useState([]);l.useEffect(()=>{const i=new Set(h.map(t=>t.user_type));j(Array.from(i))},[h]);const m=new Date,a=h.filter(i=>{const t=new Date(i.booking_date),u=new Date(i.start_time);return t<m||t.toDateString()===m.toDateString()&&u<m}),r=o?a.filter(i=>i.user_type===o):a;return e.jsx("div",{className:"table-container",children:r.length>0?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Гость"}),e.jsx("th",{children:"Тип гостя"}),e.jsx("th",{children:"Дата"}),e.jsx("th",{children:"Начало"}),e.jsx("th",{children:"Конец"}),e.jsx("th",{children:"Веники"}),e.jsx("th",{children:"Полотенца"}),e.jsx("th",{children:"Шапки"}),e.jsx("th",{children:"Простыни"}),e.jsx("th",{children:"Цена"}),e.jsx("th",{children:"Акция"})]})}),e.jsx("tbody",{children:r.map(i=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"ID",children:i.booking_id}),e.jsx("td",{"data-label":"Гость",children:i.first_name&&i.last_name?`${i.first_name} ${i.last_name}`:"Гость удален"}),e.jsx("td",{"data-label":"Тип гостя",children:i.user_type}),e.jsx("td",{"data-label":"Дата",children:new Date(i.booking_date).toLocaleDateString("ru-RU")}),e.jsx("td",{"data-label":"Начало",children:new Date(i.start_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Конец",children:new Date(i.end_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Веники",children:i.broom?i.broom_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Полотенца",children:i.towel?i.towel_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Шапки",children:i.hat?i.hat_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Простыни",children:i.sheets?i.sheets_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsxs("td",{"data-label":"Цена",children:[i.price," ₽"]}),e.jsx("td",{"data-label":"Акция",children:i.discount_status})]},i.booking_id))})]}):e.jsx("div",{className:"empty-container",children:e.jsx("p",{className:"empty-list",children:"Бронирований нет."})})})}function Le(){const{userId:h,token:o,intervals:N,fetchIntervals:f,selectedDates:j}=K(),{message:m,showMessage:a,error:r,isVisible:i}=le(),[t,u]=l.useState(5),v=async x=>{if(!x){console.error("Необходимо передать корректный идентификатор интервала для удаления.");return}try{await B.delete(`/api/adminAccount/${h}/intervals/${x}`,{headers:{Authorization:`Bearer ${o}`}}),a("Интервал успешно удален!"),f()}catch(g){console.error("Ошибка при удалении интервала:",g)}};l.useEffect(()=>{f()},[f,j]);const D=N.reduce((x,g)=>{const _=g.booking_date;return x[_]||(x[_]=[]),x[_].push(g),x},{}),S=()=>{u(x=>x+5)};return e.jsxs("div",{className:"table-container",children:[(m||r)&&e.jsx("p",{className:`auth-message ${r?"error":"success"} ${i?"fade-in":"fade-out"}`,role:"alert",children:m||r}),N.length>0?e.jsxs(e.Fragment,{children:[Object.keys(D).sort((x,g)=>new Date(x)-new Date(g)).slice(0,t).map(x=>{const g=new Date(x).toLocaleDateString("ru-RU"),_=D[x].sort((w,I)=>{const F=new Date(`1970-01-01T${w.start_time}:00`),P=new Date(`1970-01-01T${I.start_time}:00`);return F-P});return e.jsxs("div",{className:"table-date",children:[e.jsx("p",{children:g}),e.jsxs("table",{className:"table-interval",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Начало интервала"}),e.jsx("th",{children:"Конец интервала"}),e.jsx("th",{children:"Действия"})]})}),e.jsx("tbody",{children:_.map(w=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Начало интервала",children:w.start_time}),e.jsx("td",{"data-label":"Конец интервала",children:w.end_time}),e.jsx("td",{"data-label":"Действия",children:e.jsx("button",{onClick:()=>v(w.id),className:"table-button",children:"Удалить"})})]},w.id))})]})]},x)}),Object.keys(D).length>t&&e.jsx("button",{onClick:S,className:"load-more",children:"Загрузить еще"})]}):e.jsx("div",{className:"empty-container",children:e.jsx("p",{className:"empty-list",children:"Интервалов нет."})})]})}function Re({setBookingDateStart:h,setBookingDateEnd:o,setSelectedDates:N,selectedDates:f,intervals:j,bookings:m,bookingDateStart:a,bookingDateEnd:r,dateSelectionMethod:i}){const[t,u]=l.useState(new Date),[v,D]=l.useState(null),S=n=>{const b=n.getFullYear(),k=String(n.getMonth()+1).padStart(2,"0"),T=String(n.getDate()).padStart(2,"0");return`${b}-${k}-${T}`},x=new Date;x.setHours(0,0,0,0);const g=t.getFullYear(),_=t.getMonth(),w=[],I=new Date(g,_,1),F=Array.from({length:new Date(g,_+1,0).getDate()},(n,b)=>new Date(g,_,b+1)),V=(I.getDay()+6)%7;for(let n=0;n<V;n++)w.push(e.jsx("div",{"aria-hidden":"true",role:"presentation",tabIndex:"-1"},`empty-${n}`));const L=n=>{i==="range"?v?n===a?(N([]),D(null),h(""),o("")):(o(n),N(b=>{const k=new Date(a),T=new Date(n),p=[];for(let $=k;$<=T;$.setDate($.getDate()+1))p.push(S(new Date($)));return[...new Set([...b,...p])]}),D(null)):(D(n),h(n)):(N(b=>b.includes(n)?b.filter(k=>k!==n):[...b,n]),h(b=>b===n?"":n))};F.forEach(n=>{const b=S(n),T=new Date(n.setHours(0,0,0,0))<x,p=f.includes(b),$=m.some(Z=>Z.booking_date===b),A=j.some(Z=>Z.booking_date===b),M=new Date(a),U=new Date(r),H=i==="range"&&n>=M&&n<=U,X=!A&&!T,ee=b===a;let E="calendar_day";T&&(E+=" past"),(p||ee)&&(E+=" selected"),H&&(E+=" range"),A&&(E+=" interval"),$&&(E+=" booking"),X&&(E+=" no-interval"),w.push(e.jsx("div",{className:E,onClick:()=>{T||L(b)},role:"gridcell","aria-selected":!!p,"aria-current":p||ee?"date":void 0,"aria-label":`${n.toLocaleString("ru-RU",{weekday:"long"})}, ${n.getDate()} ${n.toLocaleString("ru-RU",{month:"long"})} ${n.getFullYear()}`,tabIndex:T?"-1":"0",children:n.getDate()},`day-${b}`))});const O=(7-new Date(g,_+1,0).getDay())%7;for(let n=0;n<O;n++)w.push(e.jsx("div",{"aria-hidden":"true",role:"presentation",tabIndex:"-1"},`empty-after-${n}`));const Y=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];return e.jsxs("div",{className:"calendar_container",role:"application",children:[e.jsxs("div",{className:"calendar_header",children:[e.jsx("button",{onClick:()=>u(new Date(g,_-1,1)),type:"button",className:"arrow-button","aria-label":"Предыдущий месяц",children:e.jsx(J,{icon:je})}),e.jsx("span",{style:{textAlign:"center"},children:`${Y[_]} ${g}`}),e.jsx("button",{onClick:()=>u(new Date(g,_+1,1)),type:"button",className:"arrow-button","aria-label":"Следующий месяц",children:e.jsx(J,{icon:pe})})]}),e.jsxs("div",{className:"calendar",role:"grid",children:[["ПН","ВТ","СР","ЧТ","ПТ","СБ","ВС"].map((n,b)=>e.jsx("div",{style:{textAlign:"center"},role:"columnheader",children:n},b)),w]})]})}function Ue(){const{userId:h,token:o,intervals:N,setIntervals:f,selectedDates:j,setSelectedDates:m}=K(),[a,r]=l.useState(""),[i,t]=l.useState(""),[u,v]=l.useState([]),[D,S]=l.useState(""),[x,g]=l.useState(""),[_,w]=l.useState("individual"),I=u.map(n=>({value:n.start_time.slice(0,5),label:n.start_time.slice(0,5)})),F=u.map(n=>({value:n.end_time.slice(0,5),label:n.end_time.slice(0,5)})),{message:P,showMessage:V,error:L,showError:q,isVisible:Q}=le(),O=async()=>{try{console.log("Запрос интервалов на дату: ",a);const n=await B.get(`/api/adminAccount/${h}/availableIntervals/${a}`,{headers:{Authorization:`Bearer ${o}`}});n.data.intervals&&n.data.intervals.length>0?v(n.data.intervals):v([]),S(""),g("")}catch(n){console.error("Ошибка при получении доступных интервалов:",n),q("Ошибка при получении доступных интервалов.")}};l.useEffect(()=>{console.log(N),a&&O()},[a,h]);const Y=async()=>{try{if(!a&&_==="range"||!j.length&&_==="individual"||!D||!x)throw q("Пожалуйста, выберите хотя бы одну дату и заполните все поля интервала."),new Error("Пожалуйста, выберите хотя бы одну дату и заполните все поля интервала.");const n=[];if(_==="range"){const p=new Date(a),$=new Date(i);for(let A=p;A<=$;A.setDate(A.getDate()+1)){const M=new Date(A),U=new Date(`${M.toISOString().split("T")[0]}T${D}`);if(new Date(`${M.toISOString().split("T")[0]}T${x}`)<=U)throw q("Время окончания должно быть после времени начала."),new Error("Время окончания должно быть после времени начала.");n.push({booking_date:M.toISOString().split("T")[0],start_time:D,end_time:x})}}else j.forEach(p=>{const $=new Date(p),A=new Date(`${$.toISOString().split("T")[0]}T${D}`);if(new Date(`${$.toISOString().split("T")[0]}T${x}`)<=A)throw q("Время окончания должно быть после времени начала."),new Error("Время окончания должно быть после времени начала.");n.push({booking_date:$.toISOString().split("T")[0],start_time:D,end_time:x})});const k=(await Promise.all(n.map(p=>B.post(`/api/adminAccount/${h}/intervals`,p,{headers:{Authorization:`Bearer ${o}`}})))).map(p=>p.data.interval?{id:p.data.id,booking_date:p.data.interval.booking_date,start_time:p.data.interval.start_time,end_time:p.data.interval.end_time}:(console.error("Ошибка: interval не найден в ответе",p.data),null)).filter(p=>p!==null);f(p=>[...p,...k]),S(""),g(""),r(""),t("");const T=n.length===1?"Интервал успешно добавлен!":"Интервалы успешно добавлены!";V(T),m([])}catch(n){let b=n.message;n.response&&(b=n.response.data.error||n.response.data.message||"Произошла непредвиденная ошибка."),q(`Ошибка при добавлении интервала: ${b}`)}};return e.jsxs("div",{className:"account-form",children:[(P||L)&&e.jsx("p",{className:`auth-message ${L?"error":"success"} ${Q?"fade-in":"fade-out"}`,role:"alert",children:P||L}),e.jsxs("div",{className:"form-wrapper",children:[e.jsxs("div",{className:"calendar-container",children:[e.jsxs("label",{className:"form-label date-selection-method",children:[e.jsx("span",{className:"text-secondary",children:"Выбрать "}),e.jsx("button",{type:"button",className:`mode-btn ${_==="individual"?"selected":""}`,onClick:()=>w("individual"),children:"отдельные даты"}),e.jsx("span",{className:"text-secondary",children:" / "}),e.jsx("button",{type:"button",className:`mode-btn ${_==="range"?"selected":""}`,onClick:()=>w("range"),children:"диапазон дат"})]}),e.jsx(Re,{setBookingDateStart:r,setBookingDateEnd:t,setSelectedDates:m,selectedDates:j,bookings:[],intervals:N,bookingDateStart:a,bookingDateEnd:i,dateSelectionMethod:_})]}),e.jsxs("div",{className:"time-controls",children:[e.jsxs("div",{className:"time-select",children:[e.jsx("label",{htmlFor:"startTime",className:"form-label",children:"Время начала:"}),e.jsx(ae,{id:"startTime",value:D?{value:D,label:D}:null,onChange:n=>S(n.value),options:I,classNamePrefix:"time-select",placeholder:"Выбрать время",isDisabled:I.length===0})]}),e.jsxs("div",{className:"time-select",children:[e.jsx("label",{htmlFor:"endTime",className:"form-label",children:"Время окончания:"}),e.jsx(ae,{id:"endTime",value:x?{value:x,label:x}:null,onChange:n=>g(n.value),options:F,classNamePrefix:"time-select",placeholder:"Выбрать время",isDisabled:F.length===0})]}),e.jsx("button",{onClick:Y,className:"form-button",disabled:j.length===0||!D||!x,children:"Добавить интервал"})]})]})]})}function ze(){const{discounts:h,setDiscounts:o,handleEditDiscount:N,userId:f,token:j}=K(),m=async a=>{try{const r=await B.delete(`/api/adminAccount/${f}/discounts/${a}`,{headers:{Authorization:`Bearer ${j}`}});r.status===200||r.status===204?o(h.filter(i=>i.id!==a)):alert("Ошибка при удалении акции")}catch(r){console.error("Ошибка при удалении акции:",r),alert("Ошибка при удалении акции")}};return e.jsx(e.Fragment,{children:h.length>0?e.jsx("div",{className:"discount-card-container",children:h.map(a=>e.jsxs("div",{className:"discount-card",children:[e.jsx("div",{className:"discount-header",children:e.jsxs("h4",{children:["Акция №",a.id]})}),e.jsxs("div",{className:"discount-content",children:[e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Описание акции:"})," ",e.jsx("span",{children:a.description})]}),a.time_discount_type==="no-time_limit"&&e.jsx("p",{className:"discount-info",children:"Действует постоянно"}),e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Действует"})," ",e.jsxs("span",{children:["c ",a.valid_from," до ",a.valid_till==="24:00"?"00:00":a.valid_till]})]}),a.applicable_days.length>0&&e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Применимо в дни:"}),e.jsx("span",{children:a.applicable_days.map(r=>e.jsxs("span",{children:[new Date(r).toLocaleDateString("ru-RU"),", "]},r))})]}),e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Тип скидки:"})," ",e.jsx("span",{children:a.discount_type==="discount"?"Скидка на стоимость":a.discount_type==="discount_service"?"Скидка на стоимость доп. услуги":"Бесплатные услуги"})]}),a.discount_percentage&&e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Процент скидки:"})," ",e.jsxs("span",{children:[a.discount_percentage,"%"]})]}),a.applicable_services.length>0&&e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Применимо к услугам:"}),e.jsx("span",{children:a.applicable_services.map(r=>{switch(r){case"broom":return"Веники";case"towel":return"Полотенца";case"hat":return"Шапки";case"sheets":return"Простыни";default:return r}}).join(", ")})]}),a.discount_type==="discount_service"&&a.service_prices&&e.jsx(e.Fragment,{children:a.applicable_services.map(r=>{const i=a.service_prices[r];return i!==void 0?e.jsxs("p",{className:"discount-info",children:[e.jsxs("span",{children:["Новая стоимость для ",r==="broom"?"веника":r==="towel"?"полотенца":r==="hat"?"шапки":r==="sheets"?"простыни":r,":"]})," ",e.jsxs("span",{children:[i," руб."]})]},r):null})}),a.discount_type==="free"&&a.free_service_counts&&e.jsx(e.Fragment,{children:Object.entries(a.free_service_counts).map(([r,i])=>{var t;if(i>0){let u;switch(r){case"broom":u=i===1?"веник":"веника";break;case"towel":u=i===1?"полотенце":"полотенца";break;case"hat":u=i===1?"шапка":"шапки";break;case"sheets":u=i===1?"простыня":"простыни";break;default:u=r}const v=((t=a.min_service_counts)==null?void 0:t[r])||0;return e.jsxs("p",{className:"discount-info",children:["За ",v," ",r==="broom"?"веника":r==="towel"?"полотенца":r==="hat"?"шапки":r==="sheets"?"простыни":r," ",i," ",u," в подарок"]},r)}return null})}),e.jsxs("div",{className:"actions-buttons",children:[e.jsx("button",{onClick:()=>m(a.id),className:"auth-button",children:"Удалить"}),e.jsx("p",{className:"auth-cancel",onClick:()=>N(a),children:"Редактировать"})]})]})]},a.id))}):e.jsx("div",{className:"empty-container",children:e.jsx("p",{className:"empty-list",children:"Акций нет."})})})}function We(){const{discounts:h,setCurrentDiscount:o,fetchActiveDiscounts:N,userId:f,token:j}=K(),m=Ce(),a=l.useMemo(()=>{var s;return((s=m.state)==null?void 0:s.discount)||{}},[m.state]),[r,i]=l.useState(a.description||""),[t,u]=l.useState(a.discount_type||"discount"),[v,D]=l.useState(a.applicable_services||[]),[S,x]=l.useState(a.service_prices||{broom:150,towel:200,hat:50,sheets:200}),[g,_]=l.useState(a.free_service_counts||{broom:0,towel:0,hat:0,sheets:0}),[w,I]=l.useState(a.min_service_counts||{broom:0,towel:0,hat:0,sheets:0}),[F,P]=l.useState(a.additional_services||{broom:{selected:!1,quantity:0},towel:{selected:!1,quantity:0},hat:{selected:!1,quantity:0},sheets:{selected:!1,quantity:0}}),[V,L]=l.useState(a.applicable_days||[]),[q,Q]=l.useState(new Date),[O,Y]=l.useState(a.valid_from||""),[n,b]=l.useState(a.valid_till||""),[k,T]=l.useState(a.discount_percentage||0),[p,$]=l.useState(a.time_discount_type||"no_time_limit"),A=Array.from({length:15},(s,c)=>{const d=(8+c).toString().padStart(2,"0")+":00";return{value:d,label:d}}),{message:M,showMessage:U,error:H,showError:X,isVisible:ee}=le(),E=Array.from({length:15},(s,c)=>{const d=(10+c).toString().padStart(2,"0")+":00";return{value:d,label:d}}),Z=(s,c)=>{const d=S[s];x(y=>({...y,[s]:c})),P(d!==c?y=>({...y,[s]:{...y[s],selected:!0}}):y=>({...y,[s]:{...y[s],selected:!1}}))},fe=(s,c)=>{I(d=>({...d,[s]:c}))},ve=(s,c)=>{_(d=>({...d,[s]:c}))},ce=s=>{const c=s.getFullYear(),d=String(s.getMonth()+1).padStart(2,"0"),y=String(s.getDate()).padStart(2,"0");return`${c}-${d}-${y}`};l.useEffect(()=>{if(console.log("isFormValid",me),a.id){a.discount_type==="discount_service"?x(d=>{const y=a.service_prices||{};return JSON.stringify(d)!==JSON.stringify(y)?y:d}):a.discount_type==="free"&&(_(d=>{const y=a.free_service_counts||{};return JSON.stringify(d)!==JSON.stringify(y)?y:d}),I(d=>{const y=a.min_service_counts||{};return JSON.stringify(d)!==JSON.stringify(y)?y:d}));const s=a.applicable_services||[],c={};s.forEach(d=>{c[d]={selected:!0}}),P(d=>JSON.stringify(d)!==JSON.stringify(c)?c:d)}},[a]);const be=s=>{const c=ce(s);L(d=>d.includes(c)?d.filter(y=>y!==c):[...d,c])},ge=async s=>{try{return(await B.post(`/api/adminAccount/${f}/discounts`,s,{headers:{Authorization:`Bearer ${j}`}})).data}catch(c){console.error("Ошибка при создании скидки:",c),X("Возникла ошибка при создании скидки!")}},ye=async(s,c)=>{try{return(await B.put(`/api/adminAccount/${f}/discounts/${s}`,c,{headers:{Authorization:`Bearer ${j}`}})).data}catch(d){console.error("Ошибка при обновлении скидки:",d),X("Возникла ошибка при обновлении скидки!")}},Ne=async s=>{s.preventDefault();const c={description:r,discountType:t,applicableDays:p==="time_limit"?V:[],validFrom:O,validTill:n,timeDiscountType:p,discountPercentage:t==="discount"?parseFloat(k):null,applicableServices:Object.keys(F).filter(d=>{var y;return(y=F[d])==null?void 0:y.selected}),servicePrices:t==="discount_service"?S:{},freeServiceCounts:t==="free"?g:{},minServiceCounts:t==="free"?w:{}};try{a.id?(await ye(a.id,c),U("Акция успешно обновлена!")):(await ge(c),U("Акция успешно добавлена!")),N(),U(""),oe()}catch(d){console.error("Ошибка при добавлении или обновлении скидки:",d),X("Ошибка при добавлении или обновлении скидки. Попробуйте позже.")}},oe=()=>{i(""),L([]),Y(""),b(""),T(0),D([]),x({broom:150,towel:200,hat:50,sheets:200}),_({broom:0,towel:0,hat:0,sheets:0}),I({broom:0,towel:0,hat:0,sheets:0}),o(null)},z=q.getFullYear(),W=q.getMonth(),_e=new Date(z,W,1),De=Array.from({length:new Date(z,W+1,0).getDate()},(s,c)=>new Date(z,W,c+1)),de=new Date;de.setHours(0,0,0,0);const we=(_e.getDay()+6)%7,Se=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],te=[];for(let s=0;s<we;s++)te.push(e.jsx("div",{className:"empty-cell"},`empty-${s}`));De.forEach(s=>{const c=ce(s),d=s<de,y=V.includes(c),he=h.some(Ae=>Ae.applicable_days.includes(c));let se="calendar_day";d&&(se+=" past"),y&&(se+=" selected"),he&&(se+=" discounted"),te.push(e.jsx("div",{className:se,onClick:()=>!d&&be(s),children:s.getDate()},`day-${c}`))});const $e=(7-new Date(z,W+1,0).getDay())%7;for(let s=0;s<$e;s++)te.push(e.jsx("div",{},`empty-after-${s}`));const me=r&&t&&O&&n&&((t==="discount"?k:!0)||(t==="discount_service"?Object.values(S).some(s=>s>0):!0)&&(t==="free"?Object.values(g).some(s=>s>0):!0)),ke=!r&&!O&&!n&&(!k||!Object.values(S).some(s=>s>0)||!Object.values(g).some(s=>s>0)),Te=s=>({broom:150,towel:200,hat:50,sheets:200})[s]||0;return e.jsxs("div",{className:"account-form",children:[(M||H)&&e.jsx("p",{className:`auth-message ${H?"error":"success"} ${ee?"fade-in":"fade-out"}`,role:"alert",children:M||H}),e.jsxs("form",{onSubmit:Ne,children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Описание акции:"}),e.jsx("textarea",{value:r,onChange:s=>i(s.target.value),required:!0})]}),e.jsx("div",{className:"discount-label",children:e.jsxs("label",{className:"form-label",children:[e.jsx("span",{className:"text-secondary",children:"Тип акции по длительности: "}),e.jsx("button",{type:"button",className:`mode-btn ${p==="no_time_limit"?"selected":""}`,onClick:()=>$("no_time_limit"),children:"неограниченная акция"}),e.jsx("span",{className:"text-secondary",children:" / "}),e.jsx("button",{type:"button",className:`mode-btn ${p==="time_limit"?"selected":""}`,onClick:()=>$("time_limit"),children:"ограниченная акция"})]})}),e.jsxs("div",{className:"form-wrapper",children:[p==="time_limit"&&e.jsx("div",{className:"calendar-container",children:e.jsxs("div",{className:"calendar_container",children:[e.jsxs("div",{className:"calendar_header",children:[e.jsx("button",{onClick:()=>Q(new Date(z,W-1,1)),type:"button",className:"arrow-button",children:e.jsx(J,{icon:je})}),"                                ",e.jsx("span",{children:`${Se[W]} ${z}`}),e.jsx("button",{onClick:()=>Q(new Date(z,W+1,1)),type:"button",className:"arrow-button",children:e.jsx(J,{icon:pe})})]}),e.jsxs("div",{className:"calendar",children:[["ПН","ВТ","СР","ЧТ","ПТ","СБ","ВС"].map((s,c)=>e.jsx("div",{style:{textAlign:"center",fontWeight:"bold"},children:s},c)),te]})]})}),e.jsxs("div",{className:`time-controls ${p!=="time_limit"?"align-left":""}`,children:[e.jsxs("label",{htmlFor:"startTime",className:"form-label",children:["Время начала:",e.jsx(ae,{id:"startTime",value:O?{value:O,label:O}:null,onChange:s=>Y(s.value),options:A,classNamePrefix:"time-select",placeholder:"Выберите время",isDisabled:A.length===0,required:!0})]}),e.jsx("br",{}),e.jsxs("label",{htmlFor:"endTime",className:"form-label",children:["Время окончания:",e.jsx(ae,{id:"endTime",value:n?{value:n,label:n}:null,onChange:s=>b(s.value),options:E,classNamePrefix:"time-select",placeholder:"Выберите время",isDisabled:E.length===0,required:!0})]})]})]}),e.jsx("div",{className:"discount-label",children:e.jsxs("label",{className:"form-label",children:[e.jsx("span",{className:"text-secondary",children:"Тип скидки: "}),e.jsx("button",{type:"button",className:`mode-btn ${t==="discount"?"selected":""}`,onClick:()=>u("discount"),children:"скидка на стоимость"}),e.jsx("span",{className:"text-secondary",children:" / "}),e.jsx("button",{type:"button",className:`mode-btn ${t==="discount_service"?"selected":""}`,onClick:()=>u("discount_service"),children:"скидка на доп. услугу"}),e.jsx("span",{className:"text-secondary",children:" / "}),e.jsx("button",{type:"button",className:`mode-btn ${t==="free"?"selected":""}`,onClick:()=>u("free"),children:"бесплатные услуги"})]})}),e.jsx("div",{className:"discount-container",children:e.jsxs("div",{className:"additional-services",children:[t==="discount"&&e.jsx("div",{children:e.jsxs("label",{className:"service-item perсentage-discount",children:[e.jsx("span",{children:"Процент скидки:"}),e.jsx("div",{className:"service-quantity",children:e.jsx("input",{type:"number",value:k,onChange:s=>T(s.target.value),min:"0",max:"100",required:!0,className:"service-quantity-input"})})]})}),t&&t!=="discount"&&e.jsx(e.Fragment,{children:["broom","towel","hat","sheets"].map(s=>e.jsxs("div",{children:[t==="discount_service"&&e.jsxs("label",{className:"service-item",children:[e.jsxs("span",{children:[s==="broom"?"Веник":s==="towel"?"Полотенце":s==="hat"?"Шапка":"Простыня","(изначальная цена ",Te(s)," ₽)"]}),e.jsx("div",{className:"service-quantity",children:e.jsx("input",{min:"0",type:"number",value:S[s]||"",onChange:c=>Z(s,c.target.value),className:"service-quantity-input"})})]}),t==="free"&&e.jsx("label",{className:"service-item",children:e.jsxs("div",{className:"free-service-item",children:[e.jsx("span",{children:s==="broom"?"Веник":s==="towel"?"Полотенце":s==="hat"?"Шапка":"Простыня"}),e.jsxs("div",{className:"free-service-quantity",children:[e.jsx("label",{children:"Минимальное количество для бесплатной услуги:"}),e.jsx("div",{className:"service-quantity",children:e.jsx("input",{type:"number",value:w[s]||"",onChange:c=>fe(s,c.target.value),className:"service-quantity-input",min:"0",step:"1"})})]}),e.jsxs("div",{className:"free-service-quantity",children:[e.jsx("label",{children:"Количество бесплатных услуг:"}),e.jsx("div",{className:"service-quantity",children:e.jsx("input",{type:"number",value:g[s]||"",onChange:c=>ve(s,c.target.value),className:"service-quantity-input",min:"0",step:"1"})})]})]})})]},s))})]})}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:!me,className:"form-button",children:a.id?"Сохранить изменения":"Добавить акцию"})}),!ke&&e.jsx("div",{children:e.jsx("p",{className:"auth-cancel",onClick:oe,children:"Отменить изменения"})})]})]})}function tt(){const h=xe(),[o,N]=l.useState({firstName:R.get("firstName"),lastName:R.get("lastName"),userId:R.get("userId"),token:R.get("token")});l.useEffect(()=>{R.get("token")||h("/")},[h]);const f=j=>{N(m=>({...m,firstName:j.first_name,lastName:j.last_name,phoneNumber:j.phone_number})),R.set("firstName",j.first_name,{expires:7,secure:!0,sameSite:"Strict"}),R.set("lastName",j.last_name,{expires:7,secure:!0,sameSite:"Strict"}),R.set("phoneNumber",j.phone_number,{expires:7,secure:!0,sameSite:"Strict"})};return e.jsxs("div",{children:[e.jsx(Ie,{userId:o.userId}),e.jsx("div",{className:"account-container",children:e.jsxs(Oe,{children:[e.jsx(C,{path:"/",element:e.jsx(ue,{to:"/"})}),e.jsxs(C,{path:"intervals",element:e.jsx(Fe,{userId:o.userId,token:o.token}),children:[e.jsx(C,{index:!0,element:e.jsx(Le,{})}),e.jsx(C,{path:"new-interval",element:e.jsx(Ue,{})})]}),e.jsxs(C,{path:"bookings",element:e.jsx(Pe,{userId:o.userId,token:o.token}),children:[e.jsx(C,{path:"upcoming",element:e.jsx(Me,{})}),e.jsx(C,{path:"past",element:e.jsx(Be,{})})]}),e.jsxs(C,{path:"discountsManager",element:e.jsx(qe,{userId:o.userId,token:o.token}),children:[e.jsx(C,{path:"new-discount",element:e.jsx(We,{})}),e.jsx(C,{path:"discount-list",element:e.jsx(ze,{})})]}),e.jsx(C,{path:"editProfile",element:e.jsx(Ee,{userId:o.userId,token:o.token,updateUserData:f})}),e.jsx(C,{path:"*",element:e.jsx(ue,{to:`/adminAccount/${o.userId}/intervals`})})]})})]})}export{tt as default};
