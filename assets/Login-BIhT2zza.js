import{r as u,u as K,a as h,l as I,j as e,L as X}from"./index-DsiayDso.js";import{a as T}from"./index-t--hEgTQ.js";import{F as P,f as _,a as q,b as M}from"./index-DwB9Kl1l.js";import{u as V}from"./auth-NznXChxz.js";/* empty css                        */function J(){const[m,x]=u.useState(""),[i,C]=u.useState(""),[o,w]=u.useState(!1),[l,c]=u.useState({phone:!1,password:!1}),{message:b,showMessage:D,error:f,showError:d,isVisible:A}=V(),p=K(),L=s=>{const a=s.replace(/\D/g,"").slice(0,11);let n=a;return a.length>0&&(n="+7 (",a.length>1&&(n+=`${a.slice(1,4)}`),a.length>4&&(n+=`) ${a.slice(4,7)}`),a.length>7&&(n+=`-${a.slice(7,9)}`),a.length>9&&(n+=`-${a.slice(9)}`)),n},F=s=>{const r=s.target.value,a=m;if(r.length<a.length){x(r);return}const n=L(r);x(n)},j=()=>{const s=m.replace(/\D/g,"");return s.length===10?"7"+s:s},N=async()=>{var r,a,n,y,S,v,E;d(""),c({phone:!1,password:!1});const s=j();if(!s||s.length<11||!i){d("Пожалуйста, введите корректный номер телефона и пароль."),c({phone:!s||s.length<11,password:!i});return}try{const t=await T.post("https://api.dom-ban-na-drovah.ru/api/login",{phone_number:s,password:i},{withCredentials:!0});if(t.status===200){h.set("token",t.data.token,{expires:7,secure:!0,sameSite:"Strict"}),h.set("userId",t.data.userId,{expires:7,secure:!0,sameSite:"Strict"}),h.set("firstName",t.data.first_name,{expires:7,secure:!0,sameSite:"Strict"}),h.set("lastName",t.data.last_name,{expires:7,secure:!0,sameSite:"Strict"}),D("Вход выполнен успешно!");const $=I(t.data.token);if(!$){console.error("Ошибка: токен не может быть декодирован");return}p($.role==="admin"?`/adminAccount/${t.data.userId}`:`/userAccount/${t.data.userId}`)}}catch(t){((r=t.response)==null?void 0:r.status)===401?((n=(a=t.response)==null?void 0:a.data)!=null&&n.message.includes("Пользователя с таким номером телефона не существует!")?(d("Пользователя с таким номером телефона не существует!"),c({phone:!0,password:!1})):(S=(y=t.response)==null?void 0:y.data)!=null&&S.message.includes("Неверный пароль")&&(d("Неверный пароль! Попробуйте снова."),c({phone:!1,password:!0})),setTimeout(()=>c({phone:!1,password:!1}),8e3)):d(((E=(v=t.response)==null?void 0:v.data)==null?void 0:E.message)||"Ошибка входа.")}};u.useEffect(()=>{const s=h.get("token");if(s){const r=I(s);r.exp*1e3>Date.now()&&p(r.role==="admin"?`/adminAccount/${r.userId}`:`/userAccount/${r.userId}`)}},[p]);const g=!(j().length>=11)||!i,k=s=>{s.key==="Enter"&&!g&&N()};return e.jsxs("div",{className:"auth-page auth-background",children:[e.jsx("header",{className:"auth-header",children:e.jsxs("button",{className:"back-button",onClick:()=>p("/"),"aria-label":"Вернуться на главную",children:[e.jsx(P,{icon:_}),e.jsx("span",{children:"На главную"})]})}),e.jsx("main",{className:"auth-container",children:e.jsx("div",{className:"auth-block log",children:e.jsxs("div",{className:"auth-content",children:[e.jsx("h1",{className:"auth-title",children:"ВХОД"}),(b||f)&&e.jsx("p",{className:`auth-message ${f?"error":"success"} ${A?"fade-in":"fade-out"}`,role:"alert",children:b||f}),e.jsxs("div",{className:"auth-form",children:[e.jsxs("label",{className:`auth-label ${l.phone?"error-label":""}`,htmlFor:"phone",children:["Номер телефона",e.jsx("input",{type:"tel",id:"phone",className:`auth-input ${l.phone?"error-input":""}`,placeholder:"+7 (XXX) XXX-XX-XX",onChange:F,value:m,"aria-describedby":"phoneError",required:!0,maxLength:18,onKeyDown:k}),l.phone&&e.jsx("span",{id:"phoneError",className:"error-message",children:"Неверный номер телефона"})]}),e.jsxs("label",{className:`auth-label ${l.password?"error-label":""}`,htmlFor:"password",children:["Пароль",e.jsxs("div",{className:"passwordInput",children:[e.jsx("input",{type:o?"text":"password",id:"password",className:`auth-input ${l.password?"error-input":""}`,placeholder:"Введите пароль",onChange:s=>C(s.target.value),value:i,maxLength:16,"aria-describedby":"passwordError",required:!0,onKeyDown:k}),e.jsx(P,{icon:o?q:M,className:"passwordIcon",onClick:()=>w(!o),"aria-label":o?"Скрыть пароль":"Показать пароль",tabIndex:"0",onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&w(!o)},role:"button","aria-pressed":o})]}),l.password&&e.jsx("span",{id:"passwordError",className:"error-message",children:"Неверный пароль"})]}),e.jsx("button",{className:"auth-button",onClick:N,disabled:g,"aria-disabled":g,children:"Войти"})]}),e.jsxs("div",{className:"auth-links",children:[e.jsxs("p",{children:["Еще нет учетной записи?"," ",e.jsx(X,{to:"/register",className:"auth-link",children:"Зарегистрируйтесь"})]}),e.jsx(X,{to:"/forgot-password",className:"auth-link",children:"Забыли пароль?"})]})]})})})]})}export{J as default};
