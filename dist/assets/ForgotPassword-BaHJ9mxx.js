import{r,u as K,j as e,L as M}from"./index-CgQQbYZb.js";import{a as m}from"./index-t--hEgTQ.js";import{u as R}from"./auth-Dh_wwNr8.js";import{F as g,f as v,a as P}from"./index-gqZQK566.js";function H(){const[o,C]=r.useState(""),[l,I]=r.useState(""),[k,E]=r.useState(!1),[d,S]=r.useState(""),[c,F]=r.useState(""),[L,_]=r.useState(!1),[w,b]=r.useState(null),[n,x]=r.useState(!1),[i,f]=r.useState(!1),T=K(),{message:N,showMessage:u,error:h,showError:p,isVisible:q}=R(),j=async()=>{var s,t;try{const a=await m.post("/api/forgot-password",{phone_number:o});u(a.data.message),E(!0),b(setTimeout(()=>b(null),6e4))}catch(a){p(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.error)||"Ошибка отправки кода.")}},V=()=>{j()},$=async()=>{var s,t;try{(await m.post("/api/verify-code",{phone_number:o,verification_code:l})).status===200&&(_(!0),u("Код подтверждения верен!"))}catch(a){p(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.error)||"Ошибка проверки кода.")}},D=async()=>{var s,t;if(d!==c){p("Пароли не совпадают!");return}try{const a=await m.post("/api/reset-password",{phone_number:o,verification_code:l,new_password:d});u(a.data.message),a.status===200&&T("/login")}catch(a){u(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.error)||"Ошибка восстановления пароля.")}},y=o.length>=11&&/^\d+$/.test(o);return e.jsx("div",{className:"auth-container",role:"region","aria-labelledby":"forgotPasswordTitle",children:e.jsx("div",{className:"auth-block forget",role:"group","aria-labelledby":"forgotPasswordBlockLabel",children:e.jsxs("div",{className:"auth-content",children:[e.jsx("h2",{id:"forgotPasswordTitle",className:"auth-title",children:"ВОССТАНОВЛЕНИЕ ПАРОЛЯ"}),(N||h)&&e.jsx("p",{className:`auth-message ${h?"error":"success"} ${q?"fade-in":"fade-out"}`,children:N||h}),e.jsx("div",{className:"auth-form",children:L?e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"auth-label",htmlFor:"newPasswordInput",children:["Новый пароль",e.jsxs("div",{className:"passwordInput",children:[e.jsx("input",{type:n?"text":"password",id:"newPasswordInput",className:"auth-input",value:d,onChange:s=>S(s.target.value),maxLength:16,"aria-required":"true","aria-describedby":"newPasswordError"}),e.jsx(g,{icon:n?v:P,className:"passwordIcon",onClick:()=>x(!n),"aria-label":n?"Скрыть пароль":"Показать пароль",tabIndex:"0",onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&x(!n)},role:"button","aria-pressed":n}),e.jsx("span",{id:"newPasswordError",className:"screen-reader-only"})]})]}),e.jsxs("label",{className:"auth-label",htmlFor:"confirmNewPasswordInput",children:["Подтвердите пароль",e.jsxs("div",{className:"passwordInput",children:[e.jsx("input",{type:i?"text":"password",id:"confirmNewPasswordInput",className:"auth-input",value:c,onChange:s=>F(s.target.value),maxLength:16,"aria-required":"true","aria-describedby":"confirmNewPasswordError"}),e.jsx(g,{icon:i?v:P,className:"passwordIcon",onClick:()=>f(!i),"aria-label":i?"Скрыть пароль":"Показать пароль",tabIndex:"0",onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&f(!i)},role:"button","aria-pressed":i}),e.jsx("span",{id:"confirmNewPasswordError",className:"screen-reader-only"})]})]}),e.jsx("button",{className:"auth-button",onClick:D,disabled:!(d&&c),"aria-busy":!(d&&c),"aria-live":"polite",children:"Сохранить пароль"})]}):k?e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"auth-label",htmlFor:"codeInput",children:["Код подтверждения",e.jsx("input",{type:"text",id:"codeInput",className:"auth-input",value:l,onChange:s=>I(s.target.value),maxLength:4,"aria-required":"true","aria-describedby":"codeError"}),e.jsx("span",{id:"codeError",className:"screen-reader-only"})]}),e.jsx("button",{className:"auth-button",onClick:$,disabled:!l,"aria-busy":!l,"aria-live":"polite",children:"Подтвердить код"}),w===null&&e.jsx("button",{className:"auth-button",onClick:V,"aria-busy":w===null,"aria-live":"polite",children:"Отправить код снова"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"auth-label",htmlFor:"phoneInput",children:["Номер телефона",e.jsx("input",{type:"text",id:"phoneInput",className:"auth-input",value:o,onChange:s=>C(s.target.value),placeholder:"89000000000","aria-required":"true","aria-describedby":"phoneError"}),e.jsx("span",{id:"phoneError",className:"screen-reader-only"})]}),e.jsx("p",{className:"auth-info",children:"На Ваш номер телефона поступит звонок, введите последние 4 цифры номера."}),e.jsx("button",{className:"auth-button",onClick:j,disabled:!y,"aria-busy":!y,"aria-live":"polite",children:"Отправить код"})]})}),e.jsx("div",{className:"auth-links",children:e.jsxs("p",{children:["Уже есть учетная запись?",e.jsxs(M,{to:"/login",className:"auth-link",children:[" ","Вернуться ко входу"]})]})})]})})})}export{H as default};
