import{r as l,j as e,N as G,O as ie,u as xe,b as K,c as Ce,a as R,A as Ie,R as Oe,d as C,e as ue}from"./index-B9IOy_Ju.js";import{a as B}from"./index-t--hEgTQ.js";/* empty css            */import Ee from"./EditProfile-DgJxHZBC.js";/* empty css              */import{F as J,b as ne,c as re,d as pe,e as je}from"./index-CQsnjyea.js";import{u as le}from"./auth-DE0HY2X2.js";import{S as ae}from"./react-select.esm-BDNyw1v2.js";const Fe=({userId:m,token:o})=>{const[N,v]=l.useState([]),[p,h]=l.useState([]),[a,i]=l.useState([]),r=new Date;new Date(r).setDate(r.getDate()+21);const u=l.useCallback(async()=>{try{const f=await B.get(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${m}/intervals`,{headers:{Authorization:`Bearer ${o}`}});f.data?(v(f.data.intervals),h(f.data.bookings)):console.warn("Интервалы отсутствуют в ответе",f.data)}catch(f){console.error("Ошибка при получении интервалов:",f)}},[m,o]);return l.useEffect(()=>{m&&o&&u()},[m,o,u]),e.jsxs("div",{className:"account-content",children:[e.jsxs("nav",{className:"nav",children:[e.jsx(G,{to:"",end:!0,className:({isActive:f})=>f?"nav-link active":"nav-link",children:"Список интервалов"}),e.jsx(G,{to:"new-interval",className:({isActive:f})=>f?"nav-link active":"nav-link",children:"Добавить новый интервал"})]}),e.jsx(ie,{context:{userId:m,token:o,intervals:N,setIntervals:v,fetchIntervals:u,selectedDates:a,setSelectedDates:i}})]})},Pe=({userId:m,token:o})=>{const[N,v]=l.useState([]),p=l.useCallback(async()=>{try{const h=await B.get(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${m}/bookings`,{headers:{Authorization:`Bearer ${o}`}});v(h.data),console.error(h.data)}catch(h){console.error("Ошибка при получении бронирований:",h)}},[m,o]);return l.useEffect(()=>{p()},[p]),e.jsxs("div",{className:"account-content",children:[e.jsxs("nav",{className:"nav",children:[e.jsx(G,{to:"upcoming",className:({isActive:h})=>h?"nav-link active":"nav-link",children:"Актуальные бронирования"}),e.jsx(G,{to:"past",className:({isActive:h})=>h?"nav-link active":"nav-link",children:"Прошедшие бронирования"})]}),e.jsx(ie,{context:{bookings:N}})]})},qe=({userId:m,token:o})=>{const[N,v]=l.useState([]),[p,h]=l.useState(null),a=xe(),i=t=>{h(t),a(`/adminAccount/${m}/discountsManager/new-discount`,{state:{discount:t},replace:!0})};l.useEffect(()=>{(async()=>{await new Promise(u=>setTimeout(u,1e3))})()},[]),l.useEffect(()=>{r()},[]);const r=async()=>{try{const t=await B.get("/api/adminAccount/:userId/discounts/active",{headers:{Authorization:`Bearer ${o}`}});v(t.data)}catch(t){console.error("Ошибка при загрузке скидок:",t)}};return e.jsxs("div",{className:"account-content",children:[e.jsxs("nav",{className:"nav",children:[e.jsx(G,{to:"new-discount",className:({isActive:t})=>t?"nav-link active":"nav-link",children:"Управление акциями"}),e.jsx(G,{to:"discount-list",className:({isActive:t})=>t?"nav-link active":"nav-link",children:"Список акций"})]}),e.jsx(ie,{context:{discounts:N,setDiscounts:v,currentDiscount:p,setCurrentDiscount:h,fetchActiveDiscounts:r,userId:m,token:o,handleEditDiscount:i}})]})};function Me(){const{bookings:m}=K(),o=new Date,N=m.filter(t=>{const u=new Date(t.booking_date),f=new Date(t.start_time);return u>o||u.toDateString()===o.toDateString()&&f>=o}),[v,p]=l.useState(""),[h,a]=l.useState("asc"),i=t=>{v===t?a(h==="asc"?"desc":"asc"):(p(t),a("asc"))},r=[...N].sort((t,u)=>{let f=0;switch(v){case"time":f=new Date(t.start_time)-new Date(u.start_time);break;case"price":f=t.price-u.price;break;case"name":const D=`${t.first_name} ${t.last_name}`.toLowerCase(),S=`${u.first_name} ${u.last_name}`.toLowerCase();f=D.localeCompare(S);break;default:return 0}return h==="asc"?f:-f});return e.jsx("div",{className:"table-container",children:r.length>0?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsxs("th",{onClick:()=>i("name"),className:"sortable",children:["Гость",e.jsx(J,{icon:v==="name"&&h==="asc"?ne:re,className:"sort-icon"})]}),e.jsx("th",{children:"Тип гостя"}),e.jsxs("th",{onClick:()=>i("time"),className:"sortable",children:["Дата",e.jsx(J,{icon:v==="time"&&h==="asc"?ne:re,className:"sort-icon"})]}),e.jsx("th",{children:"Начало"}),e.jsx("th",{children:"Конец"}),e.jsx("th",{children:"Веники"}),e.jsx("th",{children:"Полотенца"}),e.jsx("th",{children:"Шапки"}),e.jsx("th",{children:"Простыни"}),e.jsxs("th",{onClick:()=>i("price"),className:"sortable",children:["Цена",e.jsx(J,{icon:v==="price"&&h==="asc"?ne:re,className:"sort-icon"})]}),e.jsx("th",{children:"Акция"})]})}),e.jsx("tbody",{children:r.map(t=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"ID",children:t.booking_id}),e.jsx("td",{"data-label":"Гость",children:t.first_name&&t.last_name?`${t.first_name} ${t.last_name}`:"Гость удален"}),e.jsx("td",{"data-label":"Тип гостя",children:t.user_type}),e.jsx("td",{"data-label":"Дата",children:new Date(t.booking_date).toLocaleDateString("ru-RU")}),e.jsx("td",{"data-label":"Начало",children:new Date(t.start_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Конец",children:new Date(t.end_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Веники",children:t.broom?t.broom_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Полотенца",children:t.towel?t.towel_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Шапки",children:t.hat?t.hat_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Простыни",children:t.sheets?t.sheets_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsxs("td",{"data-label":"Цена",children:[t.price," ₽"]}),e.jsx("td",{"data-label":"Акция",children:t.discount_status})]},t.booking_id))})]}):e.jsx("div",{className:"empty-container",children:e.jsx("p",{className:"empty-list",children:"Бронирований нет."})})})}function Be(){const{bookings:m}=K(),[o,N]=l.useState(""),[v,p]=l.useState([]);l.useEffect(()=>{const r=new Set(m.map(t=>t.user_type));p(Array.from(r))},[m]);const h=new Date,a=m.filter(r=>{const t=new Date(r.booking_date),u=new Date(r.start_time);return t<h||t.toDateString()===h.toDateString()&&u<h}),i=o?a.filter(r=>r.user_type===o):a;return e.jsx("div",{className:"table-container",children:i.length>0?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Гость"}),e.jsx("th",{children:"Тип гостя"}),e.jsx("th",{children:"Дата"}),e.jsx("th",{children:"Начало"}),e.jsx("th",{children:"Конец"}),e.jsx("th",{children:"Веники"}),e.jsx("th",{children:"Полотенца"}),e.jsx("th",{children:"Шапки"}),e.jsx("th",{children:"Простыни"}),e.jsx("th",{children:"Цена"}),e.jsx("th",{children:"Акция"})]})}),e.jsx("tbody",{children:i.map(r=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"ID",children:r.booking_id}),e.jsx("td",{"data-label":"Гость",children:r.first_name&&r.last_name?`${r.first_name} ${r.last_name}`:"Гость удален"}),e.jsx("td",{"data-label":"Тип гостя",children:r.user_type}),e.jsx("td",{"data-label":"Дата",children:new Date(r.booking_date).toLocaleDateString("ru-RU")}),e.jsx("td",{"data-label":"Начало",children:new Date(r.start_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Конец",children:new Date(r.end_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Веники",children:r.broom?r.broom_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Полотенца",children:r.towel?r.towel_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Шапки",children:r.hat?r.hat_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Простыни",children:r.sheets?r.sheets_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsxs("td",{"data-label":"Цена",children:[r.price," ₽"]}),e.jsx("td",{"data-label":"Акция",children:r.discount_status})]},r.booking_id))})]}):e.jsx("div",{className:"empty-container",children:e.jsx("p",{className:"empty-list",children:"Бронирований нет."})})})}function Le(){const{userId:m,token:o,intervals:N,fetchIntervals:v,selectedDates:p}=K(),{message:h,showMessage:a,error:i,isVisible:r}=le(),[t,u]=l.useState(5),f=async x=>{if(!x){console.error("Необходимо передать корректный идентификатор интервала для удаления.");return}try{await B.delete(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${m}/intervals/${x}`,{headers:{Authorization:`Bearer ${o}`}}),a("Интервал успешно удален!"),v()}catch(g){console.error("Ошибка при удалении интервала:",g)}};l.useEffect(()=>{v()},[v,p]);const D=N.reduce((x,g)=>{const _=g.booking_date;return x[_]||(x[_]=[]),x[_].push(g),x},{}),S=()=>{u(x=>x+5)};return e.jsxs("div",{className:"table-container",children:[(h||i)&&e.jsx("p",{className:`auth-message ${i?"error":"success"} ${r?"fade-in":"fade-out"}`,role:"alert",children:h||i}),N.length>0?e.jsxs(e.Fragment,{children:[Object.keys(D).sort((x,g)=>new Date(x)-new Date(g)).slice(0,t).map(x=>{const g=new Date(x).toLocaleDateString("ru-RU"),_=D[x].sort((w,I)=>{const F=new Date(`1970-01-01T${w.start_time}:00`),P=new Date(`1970-01-01T${I.start_time}:00`);return F-P});return e.jsxs("div",{className:"table-date",children:[e.jsx("p",{children:g}),e.jsxs("table",{className:"table-interval",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Начало интервала"}),e.jsx("th",{children:"Конец интервала"}),e.jsx("th",{children:"Действия"})]})}),e.jsx("tbody",{children:_.map(w=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Начало интервала",children:w.start_time}),e.jsx("td",{"data-label":"Конец интервала",children:w.end_time}),e.jsx("td",{"data-label":"Действия",children:e.jsx("button",{onClick:()=>f(w.id),className:"table-button",children:"Удалить"})})]},w.id))})]})]},x)}),Object.keys(D).length>t&&e.jsx("button",{onClick:S,className:"load-more",children:"Загрузить еще"})]}):e.jsx("div",{className:"empty-container",children:e.jsx("p",{className:"empty-list",children:"Интервалов нет."})})]})}function Re({setBookingDateStart:m,setBookingDateEnd:o,setSelectedDates:N,selectedDates:v,intervals:p,bookings:h,bookingDateStart:a,bookingDateEnd:i,dateSelectionMethod:r}){const[t,u]=l.useState(new Date),[f,D]=l.useState(null),S=n=>{const b=n.getFullYear(),k=String(n.getMonth()+1).padStart(2,"0"),T=String(n.getDate()).padStart(2,"0");return`${b}-${k}-${T}`},x=new Date;x.setHours(0,0,0,0);const g=t.getFullYear(),_=t.getMonth(),w=[],I=new Date(g,_,1),F=Array.from({length:new Date(g,_+1,0).getDate()},(n,b)=>new Date(g,_,b+1)),V=(I.getDay()+6)%7;for(let n=0;n<V;n++)w.push(e.jsx("div",{"aria-hidden":"true",role:"presentation",tabIndex:"-1"},`empty-${n}`));const L=n=>{r==="range"?f?n===a?(N([]),D(null),m(""),o("")):(o(n),N(b=>{const k=new Date(a),T=new Date(n),j=[];for(let $=k;$<=T;$.setDate($.getDate()+1))j.push(S(new Date($)));return[...new Set([...b,...j])]}),D(null)):(D(n),m(n)):(N(b=>b.includes(n)?b.filter(k=>k!==n):[...b,n]),m(b=>b===n?"":n))};F.forEach(n=>{const b=S(n),T=new Date(n.setHours(0,0,0,0))<x,j=v.includes(b),$=h.some(Z=>Z.booking_date===b),A=p.some(Z=>Z.booking_date===b),M=new Date(a),U=new Date(i),H=r==="range"&&n>=M&&n<=U,X=!A&&!T,ee=b===a;let E="calendar_day";T&&(E+=" past"),(j||ee)&&(E+=" selected"),H&&(E+=" range"),A&&(E+=" interval"),$&&(E+=" booking"),X&&(E+=" no-interval"),w.push(e.jsx("div",{className:E,onClick:()=>{T||L(b)},role:"gridcell","aria-selected":!!j,"aria-current":j||ee?"date":void 0,"aria-label":`${n.toLocaleString("ru-RU",{weekday:"long"})}, ${n.getDate()} ${n.toLocaleString("ru-RU",{month:"long"})} ${n.getFullYear()}`,tabIndex:T?"-1":"0",children:n.getDate()},`day-${b}`))});const O=(7-new Date(g,_+1,0).getDay())%7;for(let n=0;n<O;n++)w.push(e.jsx("div",{"aria-hidden":"true",role:"presentation",tabIndex:"-1"},`empty-after-${n}`));const Y=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];return e.jsxs("div",{className:"calendar_container",role:"application",children:[e.jsxs("div",{className:"calendar_header",children:[e.jsx("button",{onClick:()=>u(new Date(g,_-1,1)),type:"button",className:"arrow-button","aria-label":"Предыдущий месяц",children:e.jsx(J,{icon:pe})}),e.jsx("span",{style:{textAlign:"center"},children:`${Y[_]} ${g}`}),e.jsx("button",{onClick:()=>u(new Date(g,_+1,1)),type:"button",className:"arrow-button","aria-label":"Следующий месяц",children:e.jsx(J,{icon:je})})]}),e.jsxs("div",{className:"calendar",role:"grid",children:[["ПН","ВТ","СР","ЧТ","ПТ","СБ","ВС"].map((n,b)=>e.jsx("div",{style:{textAlign:"center"},role:"columnheader",children:n},b)),w]})]})}function Ue(){const{userId:m,token:o,intervals:N,setIntervals:v,selectedDates:p,setSelectedDates:h}=K(),[a,i]=l.useState(""),[r,t]=l.useState(""),[u,f]=l.useState([]),[D,S]=l.useState(""),[x,g]=l.useState(""),[_,w]=l.useState("individual"),I=u.map(n=>({value:n.start_time.slice(0,5),label:n.start_time.slice(0,5)})),F=u.map(n=>({value:n.end_time.slice(0,5),label:n.end_time.slice(0,5)})),{message:P,showMessage:V,error:L,showError:q,isVisible:Q}=le(),O=async()=>{try{console.log("Запрос интервалов на дату: ",a);const n=await B.get(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${m}/availableIntervals/${a}`,{headers:{Authorization:`Bearer ${o}`}});n.data.intervals&&n.data.intervals.length>0?f(n.data.intervals):f([]),S(""),g("")}catch(n){console.error("Ошибка при получении доступных интервалов:",n),q("Ошибка при получении доступных интервалов.")}};l.useEffect(()=>{console.log(N),a&&O()},[a,m]);const Y=async()=>{try{if(!a&&_==="range"||!p.length&&_==="individual"||!D||!x)throw q("Пожалуйста, выберите хотя бы одну дату и заполните все поля интервала."),new Error("Пожалуйста, выберите хотя бы одну дату и заполните все поля интервала.");const n=[];if(_==="range"){const j=new Date(a),$=new Date(r);for(let A=j;A<=$;A.setDate(A.getDate()+1)){const M=new Date(A),U=new Date(`${M.toISOString().split("T")[0]}T${D}`);if(new Date(`${M.toISOString().split("T")[0]}T${x}`)<=U)throw q("Время окончания должно быть после времени начала."),new Error("Время окончания должно быть после времени начала.");n.push({booking_date:M.toISOString().split("T")[0],start_time:D,end_time:x})}}else p.forEach(j=>{const $=new Date(j),A=new Date(`${$.toISOString().split("T")[0]}T${D}`);if(new Date(`${$.toISOString().split("T")[0]}T${x}`)<=A)throw q("Время окончания должно быть после времени начала."),new Error("Время окончания должно быть после времени начала.");n.push({booking_date:$.toISOString().split("T")[0],start_time:D,end_time:x})});const k=(await Promise.all(n.map(j=>B.post(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${m}/intervals`,j,{headers:{Authorization:`Bearer ${o}`}})))).map(j=>j.data.interval?{id:j.data.id,booking_date:j.data.interval.booking_date,start_time:j.data.interval.start_time,end_time:j.data.interval.end_time}:(console.error("Ошибка: interval не найден в ответе",j.data),null)).filter(j=>j!==null);v(j=>[...j,...k]),S(""),g(""),i(""),t("");const T=n.length===1?"Интервал успешно добавлен!":"Интервалы успешно добавлены!";V(T),h([])}catch(n){let b=n.message;n.response&&(b=n.response.data.error||n.response.data.message||"Произошла непредвиденная ошибка."),q(`Ошибка при добавлении интервала: ${b}`)}};return e.jsxs("div",{className:"account-form",children:[(P||L)&&e.jsx("p",{className:`auth-message ${L?"error":"success"} ${Q?"fade-in":"fade-out"}`,role:"alert",children:P||L}),e.jsxs("div",{className:"form-wrapper",children:[e.jsxs("div",{className:"calendar-container",children:[e.jsxs("label",{className:"form-label date-selection-method",children:[e.jsx("span",{className:"text-secondary",children:"Выбрать "}),e.jsx("button",{type:"button",className:`mode-btn ${_==="individual"?"selected":""}`,onClick:()=>w("individual"),children:"отдельные даты"}),e.jsx("span",{className:"text-secondary",children:" / "}),e.jsx("button",{type:"button",className:`mode-btn ${_==="range"?"selected":""}`,onClick:()=>w("range"),children:"диапазон дат"})]}),e.jsx(Re,{setBookingDateStart:i,setBookingDateEnd:t,setSelectedDates:h,selectedDates:p,bookings:[],intervals:N,bookingDateStart:a,bookingDateEnd:r,dateSelectionMethod:_})]}),e.jsxs("div",{className:"time-controls",children:[e.jsxs("div",{className:"time-select",children:[e.jsx("label",{htmlFor:"startTime",className:"form-label",children:"Время начала:"}),e.jsx(ae,{id:"startTime",value:D?{value:D,label:D}:null,onChange:n=>S(n.value),options:I,classNamePrefix:"time-select",placeholder:"Выбрать время",isDisabled:I.length===0})]}),e.jsxs("div",{className:"time-select",children:[e.jsx("label",{htmlFor:"endTime",className:"form-label",children:"Время окончания:"}),e.jsx(ae,{id:"endTime",value:x?{value:x,label:x}:null,onChange:n=>g(n.value),options:F,classNamePrefix:"time-select",placeholder:"Выбрать время",isDisabled:F.length===0})]}),e.jsx("button",{onClick:Y,className:"form-button",disabled:p.length===0||!D||!x,children:"Добавить интервал"})]})]})]})}function ze(){const{discounts:m,setDiscounts:o,handleEditDiscount:N,userId:v,token:p}=K(),h=async a=>{try{const i=await B.delete(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${v}/discounts/${a}`,{headers:{Authorization:`Bearer ${p}`}});i.status===200||i.status===204?o(m.filter(r=>r.id!==a)):alert("Ошибка при удалении акции")}catch(i){console.error("Ошибка при удалении акции:",i),alert("Ошибка при удалении акции")}};return e.jsx(e.Fragment,{children:m.length>0?e.jsx("div",{className:"discount-card-container",children:m.map(a=>e.jsxs("div",{className:"discount-card",children:[e.jsx("div",{className:"discount-header",children:e.jsxs("h4",{children:["Акция №",a.id]})}),e.jsxs("div",{className:"discount-content",children:[e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Описание акции:"})," ",e.jsx("span",{children:a.description})]}),a.time_discount_type==="no-time_limit"&&e.jsx("p",{className:"discount-info",children:"Действует постоянно"}),e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Действует"})," ",e.jsxs("span",{children:["c ",a.valid_from," до ",a.valid_till==="24:00"?"00:00":a.valid_till]})]}),a.applicable_days.length>0&&e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Применимо в дни:"}),e.jsx("span",{children:a.applicable_days.map(i=>e.jsxs("span",{children:[new Date(i).toLocaleDateString("ru-RU"),", "]},i))})]}),e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Тип скидки:"})," ",e.jsx("span",{children:a.discount_type==="discount"?"Скидка на стоимость":a.discount_type==="discount_service"?"Скидка на стоимость доп. услуги":"Бесплатные услуги"})]}),a.discount_percentage&&e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Процент скидки:"})," ",e.jsxs("span",{children:[a.discount_percentage,"%"]})]}),a.applicable_services.length>0&&e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Применимо к услугам:"}),e.jsx("span",{children:a.applicable_services.map(i=>{switch(i){case"broom":return"Веники";case"towel":return"Полотенца";case"hat":return"Шапки";case"sheets":return"Простыни";default:return i}}).join(", ")})]}),a.discount_type==="discount_service"&&a.service_prices&&e.jsx(e.Fragment,{children:a.applicable_services.map(i=>{const r=a.service_prices[i];return r!==void 0?e.jsxs("p",{className:"discount-info",children:[e.jsxs("span",{children:["Новая стоимость для ",i==="broom"?"веника":i==="towel"?"полотенца":i==="hat"?"шапки":i==="sheets"?"простыни":i,":"]})," ",e.jsxs("span",{children:[r," руб."]})]},i):null})}),a.discount_type==="free"&&a.free_service_counts&&e.jsx(e.Fragment,{children:Object.entries(a.free_service_counts).map(([i,r])=>{var t;if(r>0){let u;switch(i){case"broom":u=r===1?"веник":"веника";break;case"towel":u=r===1?"полотенце":"полотенца";break;case"hat":u=r===1?"шапка":"шапки";break;case"sheets":u=r===1?"простыня":"простыни";break;default:u=i}const f=((t=a.min_service_counts)==null?void 0:t[i])||0;return e.jsxs("p",{className:"discount-info",children:["За ",f," ",i==="broom"?"веника":i==="towel"?"полотенца":i==="hat"?"шапки":i==="sheets"?"простыни":i," ",r," ",u," в подарок"]},i)}return null})}),e.jsxs("div",{className:"actions-buttons",children:[e.jsx("button",{onClick:()=>h(a.id),className:"auth-button",children:"Удалить"}),e.jsx("p",{className:"auth-cancel",onClick:()=>N(a),children:"Редактировать"})]})]})]},a.id))}):e.jsx("div",{className:"empty-container",children:e.jsx("p",{className:"empty-list",children:"Акций нет."})})})}function We(){const{discounts:m,setCurrentDiscount:o,fetchActiveDiscounts:N,userId:v,token:p}=K(),h=Ce(),a=l.useMemo(()=>{var s;return((s=h.state)==null?void 0:s.discount)||{}},[h.state]),[i,r]=l.useState(a.description||""),[t,u]=l.useState(a.discount_type||"discount"),[f,D]=l.useState(a.applicable_services||[]),[S,x]=l.useState(a.service_prices||{broom:150,towel:200,hat:50,sheets:200}),[g,_]=l.useState(a.free_service_counts||{broom:0,towel:0,hat:0,sheets:0}),[w,I]=l.useState(a.min_service_counts||{broom:0,towel:0,hat:0,sheets:0}),[F,P]=l.useState(a.additional_services||{broom:{selected:!1,quantity:0},towel:{selected:!1,quantity:0},hat:{selected:!1,quantity:0},sheets:{selected:!1,quantity:0}}),[V,L]=l.useState(a.applicable_days||[]),[q,Q]=l.useState(new Date),[O,Y]=l.useState(a.valid_from||""),[n,b]=l.useState(a.valid_till||""),[k,T]=l.useState(a.discount_percentage||0),[j,$]=l.useState(a.time_discount_type||"no_time_limit"),A=Array.from({length:15},(s,c)=>{const d=(8+c).toString().padStart(2,"0")+":00";return{value:d,label:d}}),{message:M,showMessage:U,error:H,showError:X,isVisible:ee}=le(),E=Array.from({length:15},(s,c)=>{const d=(10+c).toString().padStart(2,"0")+":00";return{value:d,label:d}}),Z=(s,c)=>{const d=S[s];x(y=>({...y,[s]:c})),P(d!==c?y=>({...y,[s]:{...y[s],selected:!0}}):y=>({...y,[s]:{...y[s],selected:!1}}))},ve=(s,c)=>{I(d=>({...d,[s]:c}))},fe=(s,c)=>{_(d=>({...d,[s]:c}))},ce=s=>{const c=s.getFullYear(),d=String(s.getMonth()+1).padStart(2,"0"),y=String(s.getDate()).padStart(2,"0");return`${c}-${d}-${y}`};l.useEffect(()=>{if(console.log("isFormValid",he),a.id){a.discount_type==="discount_service"?x(d=>{const y=a.service_prices||{};return JSON.stringify(d)!==JSON.stringify(y)?y:d}):a.discount_type==="free"&&(_(d=>{const y=a.free_service_counts||{};return JSON.stringify(d)!==JSON.stringify(y)?y:d}),I(d=>{const y=a.min_service_counts||{};return JSON.stringify(d)!==JSON.stringify(y)?y:d}));const s=a.applicable_services||[],c={};s.forEach(d=>{c[d]={selected:!0}}),P(d=>JSON.stringify(d)!==JSON.stringify(c)?c:d)}},[a]);const be=s=>{const c=ce(s);L(d=>d.includes(c)?d.filter(y=>y!==c):[...d,c])},ge=async s=>{try{return(await B.post(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${v}/discounts`,s,{headers:{Authorization:`Bearer ${p}`}})).data}catch(c){console.error("Ошибка при создании скидки:",c),X("Возникла ошибка при создании скидки!")}},ye=async(s,c)=>{try{return(await B.put(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${v}/discounts/${s}`,c,{headers:{Authorization:`Bearer ${p}`}})).data}catch(d){console.error("Ошибка при обновлении скидки:",d),X("Возникла ошибка при обновлении скидки!")}},Ne=async s=>{s.preventDefault();const c={description:i,discountType:t,applicableDays:j==="time_limit"?V:[],validFrom:O,validTill:n,timeDiscountType:j,discountPercentage:t==="discount"?parseFloat(k):null,applicableServices:Object.keys(F).filter(d=>{var y;return(y=F[d])==null?void 0:y.selected}),servicePrices:t==="discount_service"?S:{},freeServiceCounts:t==="free"?g:{},minServiceCounts:t==="free"?w:{}};try{a.id?(await ye(a.id,c),U("Акция успешно обновлена!")):(await ge(c),U("Акция успешно добавлена!")),N(),U(""),oe()}catch(d){console.error("Ошибка при добавлении или обновлении скидки:",d),X("Ошибка при добавлении или обновлении скидки. Попробуйте позже.")}},oe=()=>{r(""),L([]),Y(""),b(""),T(0),D([]),x({broom:150,towel:200,hat:50,sheets:200}),_({broom:0,towel:0,hat:0,sheets:0}),I({broom:0,towel:0,hat:0,sheets:0}),o(null)},z=q.getFullYear(),W=q.getMonth(),_e=new Date(z,W,1),De=Array.from({length:new Date(z,W+1,0).getDate()},(s,c)=>new Date(z,W,c+1)),de=new Date;de.setHours(0,0,0,0);const we=(_e.getDay()+6)%7,Se=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],te=[];for(let s=0;s<we;s++)te.push(e.jsx("div",{className:"empty-cell"},`empty-${s}`));De.forEach(s=>{const c=ce(s),d=s<de,y=V.includes(c),me=m.some(Ae=>Ae.applicable_days.includes(c));let se="calendar_day";d&&(se+=" past"),y&&(se+=" selected"),me&&(se+=" discounted"),te.push(e.jsx("div",{className:se,onClick:()=>!d&&be(s),children:s.getDate()},`day-${c}`))});const $e=(7-new Date(z,W+1,0).getDay())%7;for(let s=0;s<$e;s++)te.push(e.jsx("div",{},`empty-after-${s}`));const he=i&&t&&O&&n&&((t==="discount"?k:!0)||(t==="discount_service"?Object.values(S).some(s=>s>0):!0)&&(t==="free"?Object.values(g).some(s=>s>0):!0)),ke=!i&&!O&&!n&&(!k||!Object.values(S).some(s=>s>0)||!Object.values(g).some(s=>s>0)),Te=s=>({broom:150,towel:200,hat:50,sheets:200})[s]||0;return e.jsxs("div",{className:"account-form",children:[(M||H)&&e.jsx("p",{className:`auth-message ${H?"error":"success"} ${ee?"fade-in":"fade-out"}`,role:"alert",children:M||H}),e.jsxs("form",{onSubmit:Ne,children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Описание акции:"}),e.jsx("textarea",{value:i,onChange:s=>r(s.target.value),required:!0})]}),e.jsx("div",{className:"discount-label",children:e.jsxs("label",{className:"form-label",children:[e.jsx("span",{className:"text-secondary",children:"Тип акции по длительности: "}),e.jsx("button",{type:"button",className:`mode-btn ${j==="no_time_limit"?"selected":""}`,onClick:()=>$("no_time_limit"),children:"неограниченная акция"}),e.jsx("span",{className:"text-secondary",children:" / "}),e.jsx("button",{type:"button",className:`mode-btn ${j==="time_limit"?"selected":""}`,onClick:()=>$("time_limit"),children:"ограниченная акция"})]})}),e.jsxs("div",{className:"form-wrapper",children:[j==="time_limit"&&e.jsx("div",{className:"calendar-container",children:e.jsxs("div",{className:"calendar_container",children:[e.jsxs("div",{className:"calendar_header",children:[e.jsx("button",{onClick:()=>Q(new Date(z,W-1,1)),type:"button",className:"arrow-button",children:e.jsx(J,{icon:pe})}),"                                ",e.jsx("span",{children:`${Se[W]} ${z}`}),e.jsx("button",{onClick:()=>Q(new Date(z,W+1,1)),type:"button",className:"arrow-button",children:e.jsx(J,{icon:je})})]}),e.jsxs("div",{className:"calendar",children:[["ПН","ВТ","СР","ЧТ","ПТ","СБ","ВС"].map((s,c)=>e.jsx("div",{style:{textAlign:"center",fontWeight:"bold"},children:s},c)),te]})]})}),e.jsxs("div",{className:`time-controls ${j!=="time_limit"?"align-left":""}`,children:[e.jsxs("label",{htmlFor:"startTime",className:"form-label",children:["Время начала:",e.jsx(ae,{id:"startTime",value:O?{value:O,label:O}:null,onChange:s=>Y(s.value),options:A,classNamePrefix:"time-select",placeholder:"Выберите время",isDisabled:A.length===0,required:!0})]}),e.jsx("br",{}),e.jsxs("label",{htmlFor:"endTime",className:"form-label",children:["Время окончания:",e.jsx(ae,{id:"endTime",value:n?{value:n,label:n}:null,onChange:s=>b(s.value),options:E,classNamePrefix:"time-select",placeholder:"Выберите время",isDisabled:E.length===0,required:!0})]})]})]}),e.jsx("div",{className:"discount-label",children:e.jsxs("label",{className:"form-label",children:[e.jsx("span",{className:"text-secondary",children:"Тип скидки: "}),e.jsx("button",{type:"button",className:`mode-btn ${t==="discount"?"selected":""}`,onClick:()=>u("discount"),children:"скидка на стоимость"}),e.jsx("span",{className:"text-secondary",children:" / "}),e.jsx("button",{type:"button",className:`mode-btn ${t==="discount_service"?"selected":""}`,onClick:()=>u("discount_service"),children:"скидка на доп. услугу"}),e.jsx("span",{className:"text-secondary",children:" / "}),e.jsx("button",{type:"button",className:`mode-btn ${t==="free"?"selected":""}`,onClick:()=>u("free"),children:"бесплатные услуги"})]})}),e.jsx("div",{className:"discount-container",children:e.jsxs("div",{className:"additional-services",children:[t==="discount"&&e.jsx("div",{children:e.jsxs("label",{className:"service-item perсentage-discount",children:[e.jsx("span",{children:"Процент скидки:"}),e.jsx("div",{className:"service-quantity",children:e.jsx("input",{type:"number",value:k,onChange:s=>T(s.target.value),min:"0",max:"100",required:!0,className:"service-quantity-input"})})]})}),t&&t!=="discount"&&e.jsx(e.Fragment,{children:["broom","towel","hat","sheets"].map(s=>e.jsxs("div",{children:[t==="discount_service"&&e.jsxs("label",{className:"service-item",children:[e.jsxs("span",{children:[s==="broom"?"Веник":s==="towel"?"Полотенце":s==="hat"?"Шапка":"Простыня","(изначальная цена ",Te(s)," ₽)"]}),e.jsx("div",{className:"service-quantity",children:e.jsx("input",{min:"0",type:"number",value:S[s]||"",onChange:c=>Z(s,c.target.value),className:"service-quantity-input"})})]}),t==="free"&&e.jsx("label",{className:"service-item",children:e.jsxs("div",{className:"free-service-item",children:[e.jsx("span",{children:s==="broom"?"Веник":s==="towel"?"Полотенце":s==="hat"?"Шапка":"Простыня"}),e.jsxs("div",{className:"free-service-quantity",children:[e.jsx("label",{children:"Минимальное количество для бесплатной услуги:"}),e.jsx("div",{className:"service-quantity",children:e.jsx("input",{type:"number",value:w[s]||"",onChange:c=>ve(s,c.target.value),className:"service-quantity-input",min:"0",step:"1"})})]}),e.jsxs("div",{className:"free-service-quantity",children:[e.jsx("label",{children:"Количество бесплатных услуг:"}),e.jsx("div",{className:"service-quantity",children:e.jsx("input",{type:"number",value:g[s]||"",onChange:c=>fe(s,c.target.value),className:"service-quantity-input",min:"0",step:"1"})})]})]})})]},s))})]})}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:!he,className:"form-button",children:a.id?"Сохранить изменения":"Добавить акцию"})}),!ke&&e.jsx("div",{children:e.jsx("p",{className:"auth-cancel",onClick:oe,children:"Отменить изменения"})})]})]})}function tt(){const m=xe(),[o,N]=l.useState({firstName:R.get("firstName"),lastName:R.get("lastName"),userId:R.get("userId"),token:R.get("token")});l.useEffect(()=>{R.get("token")||m("/")},[m]);const v=p=>{N(h=>({...h,firstName:p.first_name,lastName:p.last_name,phoneNumber:p.phone_number})),R.set("firstName",p.first_name,{expires:7,secure:!0,sameSite:"Strict"}),R.set("lastName",p.last_name,{expires:7,secure:!0,sameSite:"Strict"}),R.set("phoneNumber",p.phone_number,{expires:7,secure:!0,sameSite:"Strict"})};return e.jsxs("div",{children:[e.jsx(Ie,{userId:o.userId}),e.jsx("div",{className:"account-container",children:e.jsxs(Oe,{children:[e.jsx(C,{path:"/",element:e.jsx(ue,{to:"/"})}),e.jsxs(C,{path:"intervals",element:e.jsx(Fe,{userId:o.userId,token:o.token}),children:[e.jsx(C,{index:!0,element:e.jsx(Le,{})}),e.jsx(C,{path:"new-interval",element:e.jsx(Ue,{})})]}),e.jsxs(C,{path:"bookings",element:e.jsx(Pe,{userId:o.userId,token:o.token}),children:[e.jsx(C,{path:"upcoming",element:e.jsx(Me,{})}),e.jsx(C,{path:"past",element:e.jsx(Be,{})})]}),e.jsxs(C,{path:"discountsManager",element:e.jsx(qe,{userId:o.userId,token:o.token}),children:[e.jsx(C,{path:"new-discount",element:e.jsx(We,{})}),e.jsx(C,{path:"discount-list",element:e.jsx(ze,{})})]}),e.jsx(C,{path:"editProfile",element:e.jsx(Ee,{userId:o.userId,token:o.token,updateUserData:v})}),e.jsx(C,{path:"*",element:e.jsx(ue,{to:`/adminAccount/${o.userId}/intervals`})})]})})]})}export{tt as default};
