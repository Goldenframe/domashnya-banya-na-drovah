import{r as l,j as e,N as P,O as re,u as ue,b as ee,c as Te,a as W,A as Ie,R as Oe,d as I,e as he}from"./index-DdpchCr5.js";import{a as U}from"./index-t--hEgTQ.js";/* empty css            */import Pe from"./EditProfile-eTuNwKhQ.js";/* empty css              */import{F as R,c as X,d as Z,e as xe,g as je}from"./index-BI7l9tmv.js";import{u as le}from"./auth-Klx812yd.js";import{S as ie}from"./react-select.esm-BzETQS-_.js";const Ee=({userId:d,token:r})=>{const[D,g]=l.useState([]),[v,o]=l.useState([]),[a,i]=l.useState([]),p=new Date;new Date(p).setDate(p.getDate()+21);const b=l.useCallback(async()=>{try{const x=await U.get(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${d}/intervals`,{headers:{Authorization:`Bearer ${r}`}});x.data?(g(x.data.intervals),o(x.data.bookings)):console.warn("Интервалы отсутствуют в ответе",x.data)}catch(x){console.error("Ошибка при получении интервалов:",x)}},[d,r]);return l.useEffect(()=>{d&&r&&b()},[d,r,b]),e.jsxs("div",{className:"account-content",children:[e.jsx("nav",{className:"nav","aria-label":"Меню управления интервалами",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(P,{to:"",end:!0,className:({isActive:x})=>x?"nav-link active":"nav-link","aria-current":({isActive:x})=>x?"page":null,children:"Список интервалов"})}),e.jsx("li",{children:e.jsx(P,{to:"new-interval",className:({isActive:x})=>x?"nav-link active":"nav-link","aria-current":({isActive:x})=>x?"page":null,children:"Добавить новый интервал"})})]})}),e.jsx("main",{className:"content",role:"main",children:e.jsx(re,{context:{userId:d,token:r,intervals:D,setIntervals:g,fetchIntervals:b,selectedDates:a,setSelectedDates:i}})})]})},Me=({userId:d,token:r})=>{const[D,g]=l.useState([]),v=l.useCallback(async()=>{try{const o=await U.get(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${d}/bookings`,{headers:{Authorization:`Bearer ${r}`}});g(o.data),console.error(o.data)}catch(o){console.error("Ошибка при получении бронирований:",o)}},[d,r]);return l.useEffect(()=>{v()},[v]),e.jsxs("div",{className:"account-content",children:[e.jsx("nav",{className:"nav","aria-label":"Меню бронирований",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(P,{to:"upcoming",className:({isActive:o})=>o?"nav-link active":"nav-link","aria-current":({isActive:o})=>o?"page":null,children:"Предстоящие"})}),e.jsx("li",{children:e.jsx(P,{to:"past",className:({isActive:o})=>o?"nav-link active":"nav-link","aria-current":({isActive:o})=>o?"page":null,children:"Прошедшие"})})]})}),e.jsx("main",{className:"content",role:"main",children:e.jsx(re,{context:{bookings:D}})})]})},Fe=({userId:d,token:r})=>{const[D,g]=l.useState([]),[v,o]=l.useState(null),a=ue(),i=t=>{o(t),a(`/adminAccount/${d}/discountsManager/new-discount`,{state:{discount:t},replace:!0})};l.useEffect(()=>{(async()=>{await new Promise(b=>setTimeout(b,1e3))})()},[]),l.useEffect(()=>{p()},[]);const p=async()=>{try{const t=await U.get(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${d}/discounts/active`,{headers:{Authorization:`Bearer ${r}`}});g(t.data)}catch(t){console.error("Ошибка при загрузке скидок:",t)}};return e.jsxs("div",{className:"account-content",children:[e.jsx("nav",{className:"nav","aria-label":"Меню управления скидками",children:e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx(P,{to:"new-discount",className:({isActive:t})=>t?"nav-link active":"nav-link","aria-current":({isActive:t})=>t?"page":null,children:"Управление акциями"})}),e.jsx("li",{children:e.jsx(P,{to:"discount-list",className:({isActive:t})=>t?"nav-link active":"nav-link","aria-current":({isActive:t})=>t?"page":null,children:"Список акций"})})]})}),e.jsx("main",{className:"content",role:"main",children:e.jsx(re,{context:{discounts:D,setDiscounts:g,currentDiscount:v,setCurrentDiscount:o,fetchActiveDiscounts:p,userId:d,token:r,handleEditDiscount:i}})})]})};function qe(){const{bookings:d}=ee(),r=new Date,D=d.filter(t=>{const b=new Date(t.booking_date),x=new Date(t.start_time);return b>r||b.toDateString()===r.toDateString()&&x>=r}),[g,v]=l.useState(""),[o,a]=l.useState("asc"),i=t=>{g===t?a(o==="asc"?"desc":"asc"):(v(t),a("asc"))},p=[...D].sort((t,b)=>{let x=0;switch(g){case"time":x=new Date(t.start_time)-new Date(b.start_time);break;case"price":x=t.price-b.price;break;case"name":const _=`${t.first_name} ${t.last_name}`.toLowerCase(),S=`${b.first_name} ${b.last_name}`.toLowerCase();x=_.localeCompare(S);break;default:return 0}return o==="asc"?x:-x});return e.jsx("div",{className:"table-container",children:p.length>0?e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsxs("th",{onClick:()=>i("name"),className:"sortable",children:["Гость",e.jsx(R,{icon:g==="name"&&o==="asc"?X:Z,className:"sort-icon"})]}),e.jsx("th",{children:"Тип гостя"}),e.jsxs("th",{onClick:()=>i("time"),className:"sortable",children:["Дата",e.jsx(R,{icon:g==="time"&&o==="asc"?X:Z,className:"sort-icon"})]}),e.jsx("th",{children:"Начало"}),e.jsx("th",{children:"Конец"}),e.jsx("th",{children:"Веники"}),e.jsx("th",{children:"Полот."}),e.jsx("th",{children:"Шапки"}),e.jsx("th",{children:"Прост."}),e.jsxs("th",{onClick:()=>i("price"),className:"sortable",children:["Цена",e.jsx(R,{icon:g==="price"&&o==="asc"?X:Z,className:"sort-icon"})]}),e.jsx("th",{children:"Акция"})]})}),e.jsx("tbody",{children:p.map(t=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"ID",className:"td-header",children:t.booking_id}),e.jsx("td",{"data-label":"Гость",children:t.first_name&&t.last_name?`${t.first_name} ${t.last_name}`:"Гость удален"}),e.jsx("td",{"data-label":"Тип гостя",children:t.user_type}),e.jsx("td",{"data-label":"Дата",children:new Date(t.booking_date).toLocaleDateString("ru-RU")}),e.jsx("td",{"data-label":"Начало",children:new Date(t.start_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Конец",children:new Date(t.end_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Веники",children:t.broom?t.broom_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Полотенца",children:t.towel?t.towel_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Шапки",children:t.hat?t.hat_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Простыни",children:t.sheets?t.sheets_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsxs("td",{"data-label":"Цена",children:[t.price," ₽"]}),e.jsx("td",{"data-label":"Акция",children:t.discount_status})]},t.booking_id))})]}):e.jsx("div",{className:"empty-container",children:e.jsx("p",{className:"empty-list",children:"Бронирований нет."})})})}function Be(){const{bookings:d}=ee(),[r,D]=l.useState(""),[g,v]=l.useState([]),[o,a]=l.useState(""),[i,p]=l.useState("asc");l.useEffect(()=>{const n=new Set(d.map(f=>f.user_type));v(Array.from(n))},[d]);const t=new Date,b=d.filter(n=>{const f=new Date(n.booking_date),j=new Date(n.start_time);return f<t||f.toDateString()===t.toDateString()&&j<t}),x=n=>{o===n?p(i==="asc"?"desc":"asc"):(a(n),p("asc"))},_=[...b].sort((n,f)=>{let j=0;switch(o){case"time":j=new Date(n.start_time)-new Date(f.start_time);break;case"price":j=n.price-f.price;break;case"name":const $=`${n.first_name} ${n.last_name}`.toLowerCase(),C=`${f.first_name} ${f.last_name}`.toLowerCase();j=$.localeCompare(C);break;default:return 0}return i==="asc"?j:-j}),S=r?_.filter(n=>n.user_type===r):_;return e.jsx("div",{className:"table-container",children:S.length>0?e.jsx(e.Fragment,{children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsxs("th",{onClick:()=>x("name"),className:"sortable",children:["Гость",e.jsx(R,{icon:o==="name"&&i==="asc"?X:Z,className:"sort-icon"})]}),e.jsx("th",{children:"Тип гостя"}),e.jsxs("th",{onClick:()=>x("time"),className:"sortable",children:["Дата",e.jsx(R,{icon:o==="time"&&i==="asc"?X:Z,className:"sort-icon"})]}),e.jsx("th",{children:"Начало"}),e.jsx("th",{children:"Конец"}),e.jsx("th",{children:"Веники"}),e.jsx("th",{children:"Полот."}),e.jsx("th",{children:"Шапки"}),e.jsx("th",{children:"Прост."}),e.jsxs("th",{onClick:()=>x("price"),className:"sortable",children:["Цена",e.jsx(R,{icon:o==="price"&&i==="asc"?X:Z,className:"sort-icon"})]}),e.jsx("th",{children:"Акция"})]})}),e.jsx("tbody",{children:S.map(n=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"ID",className:"td-header",children:n.booking_id}),e.jsx("td",{"data-label":"Гость",children:n.first_name&&n.last_name?`${n.first_name} ${n.last_name}`:"Гость удален"}),e.jsx("td",{"data-label":"Тип гостя",children:n.user_type}),e.jsx("td",{"data-label":"Дата",children:new Date(n.booking_date).toLocaleDateString("ru-RU")}),e.jsx("td",{"data-label":"Начало",children:new Date(n.start_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Конец",children:new Date(n.end_time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("td",{"data-label":"Веники",children:n.broom?n.broom_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Полотенца",children:n.towel?n.towel_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Шапки",children:n.hat?n.hat_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsx("td",{"data-label":"Простыни",children:n.sheets?n.sheets_quantity:e.jsx("span",{className:"not-selected",children:"0"})}),e.jsxs("td",{"data-label":"Цена",children:[n.price," ₽"]}),e.jsx("td",{"data-label":"Акция",children:n.discount_status})]},n.booking_id))})]})}):e.jsx("div",{className:"empty-container",children:e.jsx("p",{className:"empty-list",children:"Бронирований нет."})})})}function Le(){const{userId:d,token:r,intervals:D,fetchIntervals:g,selectedDates:v}=ee(),{message:o,showMessage:a,error:i,isVisible:p}=le(),[t,b]=l.useState(5),x=async n=>{if(!n){console.error("Необходимо передать корректный идентификатор интервала для удаления.");return}try{await U.delete(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${d}/intervals/${n}`,{headers:{Authorization:`Bearer ${r}`}}),a("Интервал успешно удален!"),g()}catch(f){console.error("Ошибка при удалении интервала:",f)}};l.useEffect(()=>{g()},[g,v]);const _=D.reduce((n,f)=>{const j=f.booking_date;return n[j]||(n[j]=[]),n[j].push(f),n},{}),S=()=>{b(n=>n+5)};return e.jsxs("div",{className:"table-container",children:[(o||i)&&e.jsx("p",{className:`auth-message ${i?"error":"success"} ${p?"fade-in":"fade-out"}`,role:"alert",children:o||i}),D.length>0?e.jsxs(e.Fragment,{children:[Object.keys(_).sort((n,f)=>new Date(n)-new Date(f)).slice(0,t).map(n=>{const f=new Date(n).toLocaleDateString("ru-RU"),j=_[n].sort(($,C)=>{const z=new Date(`1970-01-01T${$.start_time}:00`),E=new Date(`1970-01-01T${C.start_time}:00`);return z-E});return e.jsxs("div",{className:"table-date",children:[e.jsx("p",{children:f}),e.jsxs("table",{className:"table-interval",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Начало интервала"}),e.jsx("th",{children:"Конец интервала"}),e.jsx("th",{children:"Действия"})]})}),e.jsx("tbody",{children:j.map($=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Начало интервала",children:$.start_time}),e.jsx("td",{"data-label":"Конец интервала",children:$.end_time}),e.jsx("td",{"data-label":"Действия",children:e.jsx("button",{onClick:()=>x($.id),className:"table-button",children:"Удалить"})})]},$.id))})]})]},n)}),Object.keys(_).length>t&&e.jsx("button",{onClick:S,className:"load-more",children:"Загрузить еще"})]}):e.jsx("div",{className:"empty-container",children:e.jsx("p",{className:"empty-list",children:"Интервалов нет."})})]})}function Re({setBookingDateStart:d,setBookingDateEnd:r,setSelectedDates:D,selectedDates:g,intervals:v,bookings:o,bookingDateStart:a,bookingDateEnd:i,dateSelectionMethod:p}){const[t,b]=l.useState(new Date),[x,_]=l.useState(null),S=c=>{const N=c.getFullYear(),u=String(c.getMonth()+1).padStart(2,"0"),k=String(c.getDate()).padStart(2,"0");return`${N}-${u}-${k}`},n=new Date;n.setHours(0,0,0,0);const f=t.getFullYear(),j=t.getMonth(),$=[],C=new Date(f,j,1),z=Array.from({length:new Date(f,j+1,0).getDate()},(c,N)=>new Date(f,j,N+1)),M=(C.getDay()+6)%7;for(let c=0;c<M;c++)$.push(e.jsx("div",{"aria-hidden":"true",role:"presentation",tabIndex:"-1"},`empty-${c}`));const K=c=>{p==="range"?x?c===a?(D([]),_(null),d(""),r("")):(r(c),D(N=>{const u=new Date(a),k=new Date(c),A=[];for(let O=u;O<=k;O.setDate(O.getDate()+1))A.push(S(new Date(O)));return[...new Set([...N,...A])]}),_(null)):(_(c),d(c)):(D(N=>N.includes(c)?N.filter(u=>u!==c):[...N,c]),d(N=>N===c?"":c))};z.forEach(c=>{const N=S(c),k=new Date(c.setHours(0,0,0,0))<n,A=g.includes(N),O=o.some(se=>se.booking_date===N),w=v.some(se=>se.booking_date===N),q=new Date(a),T=new Date(i),B=p==="range"&&c>=q&&c<=T,V=!w&&!k,te=N===a;let L="calendar_day";k&&(L+=" past"),(A||te)&&(L+=" selected"),B&&(L+=" range"),w&&(L+=" interval"),O&&(L+=" booking"),V&&(L+=" no-interval"),$.push(e.jsx("div",{className:L,onClick:()=>{k||K(N)},role:"gridcell","aria-selected":!!A,"aria-current":A||te?"date":void 0,"aria-label":`${c.toLocaleString("ru-RU",{weekday:"long"})}, ${c.getDate()} ${c.toLocaleString("ru-RU",{month:"long"})} ${c.getFullYear()}`,tabIndex:k?"-1":"0",children:c.getDate()},`day-${N}`))});const F=(7-new Date(f,j+1,0).getDay())%7;for(let c=0;c<F;c++)$.push(e.jsx("div",{"aria-hidden":"true",role:"presentation",tabIndex:"-1"},`empty-after-${c}`));const J=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];return e.jsxs("div",{className:"calendar_container",role:"application",children:[e.jsxs("div",{className:"calendar_header",children:[e.jsx("button",{onClick:()=>b(new Date(f,j-1,1)),type:"button",className:"arrow-button","aria-label":"Предыдущий месяц",children:e.jsx(R,{icon:xe})}),e.jsx("span",{style:{textAlign:"center"},children:`${J[j]} ${f}`}),e.jsx("button",{onClick:()=>b(new Date(f,j+1,1)),type:"button",className:"arrow-button","aria-label":"Следующий месяц",children:e.jsx(R,{icon:je})})]}),e.jsxs("div",{className:"calendar",role:"grid",children:[["ПН","ВТ","СР","ЧТ","ПТ","СБ","ВС"].map((c,N)=>e.jsx("div",{style:{textAlign:"center"},role:"columnheader",children:c},N)),$]})]})}function Ue(){const{userId:d,token:r,intervals:D,setIntervals:g,selectedDates:v,setSelectedDates:o}=ee(),[a,i]=l.useState(""),[p,t]=l.useState(""),[b,x]=l.useState([]),[_,S]=l.useState(""),[n,f]=l.useState(""),[j,$]=l.useState("individual"),{message:C,showMessage:z,error:E,showError:M,isVisible:K}=le(),G=b.map(u=>({value:u.start_time.slice(0,5),label:u.start_time.slice(0,5)})),Q=b.map(u=>({value:u.end_time.slice(0,5),label:u.end_time.slice(0,5)})),F=async()=>{try{const u=await U.get(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${d}/availableIntervals/${a}`,{headers:{Authorization:`Bearer ${r}`}});u.data.intervals&&u.data.intervals.length>0?x(u.data.intervals):x([]),S(""),f("")}catch{M("Ошибка при получении доступных интервалов.")}};l.useEffect(()=>{a&&F()},[a,d]);const J=async()=>{try{if(!a&&j==="range"||!v.length&&j==="individual"||!_||!n)throw M("Пожалуйста, выберите хотя бы одну дату и заполните все поля интервала."),new Error("Пожалуйста, выберите хотя бы одну дату и заполните все поля интервала.");const u=[];if(j==="range"){const w=new Date(a),q=new Date(p);for(let T=w;T<=q;T.setDate(T.getDate()+1)){const B=new Date(T),V=new Date(`${B.toISOString().split("T")[0]}T${_}`);if(new Date(`${B.toISOString().split("T")[0]}T${n}`)<=V)throw M("Время окончания должно быть после времени начала."),new Error("Время окончания должно быть после времени начала.");u.push({booking_date:B.toISOString().split("T")[0],start_time:_,end_time:n})}}else v.forEach(w=>{const q=new Date(w),T=new Date(`${q.toISOString().split("T")[0]}T${_}`);if(new Date(`${q.toISOString().split("T")[0]}T${n}`)<=T)throw M("Время окончания должно быть после времени начала."),new Error("Время окончания должно быть после времени начала.");u.push({booking_date:q.toISOString().split("T")[0],start_time:_,end_time:n})});const A=(await Promise.all(u.map(w=>U.post(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${d}/intervals`,w,{headers:{Authorization:`Bearer ${r}`}})))).map(w=>w.data.interval?{id:w.data.id,booking_date:w.data.interval.booking_date,start_time:w.data.interval.start_time,end_time:w.data.interval.end_time}:null).filter(w=>w!==null);g(w=>[...w,...A]),S(""),f(""),i(""),t("");const O=u.length===1?"Интервал успешно добавлен!":"Интервалы успешно добавлены!";z(O),o([])}catch(u){let k=u.message;u.response&&(k=u.response.data.error||u.response.data.message||"Произошла непредвиденная ошибка."),M(`Ошибка при добавлении интервала: ${k}`)}},c=j==="range"&&(!a||!p)||j==="individual"&&v.length===0||!_||!n,N=u=>{u.key==="Enter"&&!c&&J()};return e.jsxs("div",{className:"account-form",onKeyDown:N,children:[(C||E)&&e.jsx("div",{className:`auth-message ${E?"error":"success"} ${K?"fade-in":"fade-out"}`,role:"alert","aria-live":"assertive",children:C||E}),e.jsxs("div",{className:"form-wrapper",children:[e.jsxs("div",{className:"calendar-container",children:[e.jsxs("fieldset",{className:"date-selection-method",children:[e.jsx("legend",{className:"form-label",children:e.jsx("span",{className:"text-secondary",children:"Выбрать метод выбора дат:"})}),e.jsxs("div",{className:"method-buttons",children:[e.jsx("button",{type:"button",className:`mode-btn ${j==="individual"?"selected":""}`,onClick:()=>$("individual"),"aria-pressed":j==="individual",children:"отдельные даты"}),e.jsx("span",{className:"text-secondary",children:" / "}),e.jsx("button",{type:"button",className:`mode-btn ${j==="range"?"selected":""}`,onClick:()=>$("range"),"aria-pressed":j==="range",children:"диапазон дат"})]})]}),e.jsx(Re,{setBookingDateStart:i,setBookingDateEnd:t,setSelectedDates:o,selectedDates:v,bookings:[],intervals:D,bookingDateStart:a,bookingDateEnd:p,dateSelectionMethod:j})]}),e.jsxs("div",{className:"time-controls",children:[e.jsxs("div",{className:"time-select",children:[e.jsx("label",{htmlFor:"startTime",className:"form-label",children:"Время начала:"}),e.jsx(ie,{id:"startTime",value:_?{value:_,label:_}:null,onChange:u=>S(u.value),options:G,classNamePrefix:"time-select",placeholder:"Выбрать время",isDisabled:G.length===0,"aria-label":"Выберите время начала",inputId:"startTime-input",noOptionsMessage:()=>"Нет доступных вариантов",onKeyDown:N})]}),e.jsxs("div",{className:"time-select",children:[e.jsx("label",{htmlFor:"endTime",className:"form-label",children:"Время окончания:"}),e.jsx(ie,{id:"endTime",value:n?{value:n,label:n}:null,onChange:u=>f(u.value),options:Q,classNamePrefix:"time-select",placeholder:"Выбрать время",isDisabled:Q.length===0,"aria-label":"Выберите время окончания",inputId:"endTime-input",noOptionsMessage:()=>"Нет доступных вариантов",onKeyDown:N})]}),e.jsx("button",{onClick:J,className:"form-button",disabled:c,"aria-disabled":c,children:"Добавить интервал"})]})]})]})}function ze(){const{discounts:d,setDiscounts:r,handleEditDiscount:D,userId:g,token:v}=ee(),o=async a=>{try{const i=await U.delete(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${g}/discounts/${a}`,{headers:{Authorization:`Bearer ${v}`}});i.status===200||i.status===204?r(d.filter(p=>p.id!==a)):alert("Ошибка при удалении акции")}catch(i){console.error("Ошибка при удалении акции:",i),alert("Ошибка при удалении акции")}};return e.jsx(e.Fragment,{children:d.length>0?e.jsx("div",{className:"discount-card-container",children:d.map(a=>e.jsxs("div",{className:"discount-card",children:[e.jsx("div",{className:"discount-header",children:e.jsxs("h4",{children:["Акция №",a.id]})}),e.jsxs("div",{className:"discount-content",children:[e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Описание акции:"})," ",e.jsx("span",{children:a.description})]}),a.time_discount_type==="no-time_limit"&&e.jsx("p",{className:"discount-info",children:"Действует постоянно"}),e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Действует"})," ",e.jsxs("span",{children:["c ",a.valid_from," до ",a.valid_till==="24:00"?"00:00":a.valid_till]})]}),a.applicable_days.length>0&&e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Применимо в дни:"}),e.jsx("span",{children:a.applicable_days.map(i=>e.jsxs("span",{children:[new Date(i).toLocaleDateString("ru-RU"),", "]},i))})]}),e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Тип скидки:"})," ",e.jsx("span",{children:a.discount_type==="discount"?"Скидка на стоимость":a.discount_type==="discount_service"?"Скидка на стоимость доп. услуги":"Бесплатные услуги"})]}),a.discount_percentage&&e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Процент скидки:"})," ",e.jsxs("span",{children:[a.discount_percentage,"%"]})]}),a.applicable_services.length>0&&e.jsxs("p",{className:"discount-info",children:[e.jsx("span",{children:"Применимо к услугам:"}),e.jsx("span",{children:a.applicable_services.map(i=>{switch(i){case"broom":return"Веники";case"towel":return"Полотенца";case"hat":return"Шапки";case"sheets":return"Простыни";default:return i}}).join(", ")})]}),a.discount_type==="discount_service"&&a.service_prices&&e.jsx(e.Fragment,{children:a.applicable_services.map(i=>{const p=a.service_prices[i];return p!==void 0?e.jsxs("p",{className:"discount-info",children:[e.jsxs("span",{children:["Новая стоимость для ",i==="broom"?"веника":i==="towel"?"полотенца":i==="hat"?"шапки":i==="sheets"?"простыни":i,":"]})," ",e.jsxs("span",{children:[p," руб."]})]},i):null})}),a.discount_type==="free"&&a.free_service_counts&&e.jsx(e.Fragment,{children:Object.entries(a.free_service_counts).map(([i,p])=>{var t;if(p>0){let b;switch(i){case"broom":b=p===1?"веник":"веника";break;case"towel":b=p===1?"полотенце":"полотенца";break;case"hat":b=p===1?"шапка":"шапки";break;case"sheets":b=p===1?"простыня":"простыни";break;default:b=i}const x=((t=a.min_service_counts)==null?void 0:t[i])||0;return e.jsxs("p",{className:"discount-info",children:["За ",x," ",i==="broom"?"веника":i==="towel"?"полотенца":i==="hat"?"шапки":i==="sheets"?"простыни":i," ",p," ",b," в подарок"]},i)}return null})}),e.jsxs("div",{className:"actions-buttons",children:[e.jsx("button",{onClick:()=>o(a.id),className:"auth-button",children:"Удалить"}),e.jsx("p",{className:"auth-cancel",onClick:()=>D(a),children:"Редактировать"})]})]})]},a.id))}):e.jsx("div",{className:"empty-container",children:e.jsx("p",{className:"empty-list",children:"Акций нет."})})})}function We(){const{discounts:d,setCurrentDiscount:r,fetchActiveDiscounts:D,userId:g,token:v}=ee(),o=Te(),a=l.useMemo(()=>{var s;return((s=o.state)==null?void 0:s.discount)||{}},[o.state]),[i,p]=l.useState(a.description||""),[t,b]=l.useState(a.discount_type||"discount"),[x,_]=l.useState(a.applicable_services||[]),[S,n]=l.useState(a.service_prices||{broom:150,towel:200,hat:50,sheets:200}),[f,j]=l.useState(a.free_service_counts||{broom:0,towel:0,hat:0,sheets:0}),[$,C]=l.useState(a.min_service_counts||{broom:0,towel:0,hat:0,sheets:0}),[z,E]=l.useState(a.additional_services||{broom:{selected:!1,quantity:0},towel:{selected:!1,quantity:0},hat:{selected:!1,quantity:0},sheets:{selected:!1,quantity:0}}),[M,K]=l.useState(a.applicable_days||[]),[G,Q]=l.useState(new Date),[F,J]=l.useState(a.valid_from||""),[c,N]=l.useState(a.valid_till||""),[u,k]=l.useState(a.discount_percentage||0),[A,O]=l.useState(a.time_discount_type||"no_time_limit"),w=Array.from({length:15},(s,m)=>{const h=(8+m).toString().padStart(2,"0")+":00";return{value:h,label:h}}),{message:q,showMessage:T,error:B,showError:V,isVisible:te}=le(),L=Array.from({length:15},(s,m)=>{const h=(10+m).toString().padStart(2,"0")+":00";return{value:h,label:h}}),se=(s,m)=>{const h=S[s];n(y=>({...y,[s]:m})),E(h!==m?y=>({...y,[s]:{...y[s],selected:!0}}):y=>({...y,[s]:{...y[s],selected:!1}}))},pe=(s,m)=>{C(h=>({...h,[s]:m}))},fe=(s,m)=>{j(h=>({...h,[s]:m}))},ce=s=>{const m=s.getFullYear(),h=String(s.getMonth()+1).padStart(2,"0"),y=String(s.getDate()).padStart(2,"0");return`${m}-${h}-${y}`};l.useEffect(()=>{if(a.id){a.discount_type==="discount_service"?n(h=>{const y=a.service_prices||{};return JSON.stringify(h)!==JSON.stringify(y)?y:h}):a.discount_type==="free"&&(j(h=>{const y=a.free_service_counts||{};return JSON.stringify(h)!==JSON.stringify(y)?y:h}),C(h=>{const y=a.min_service_counts||{};return JSON.stringify(h)!==JSON.stringify(y)?y:h}));const s=a.applicable_services||[],m={};s.forEach(h=>{m[h]={selected:!0}}),E(h=>JSON.stringify(h)!==JSON.stringify(m)?m:h)}},[a]);const be=s=>{const m=ce(s);K(h=>h.includes(m)?h.filter(y=>y!==m):[...h,m])},ve=async s=>{try{return(await U.post(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${g}/discounts`,s,{headers:{Authorization:`Bearer ${v}`}})).data}catch{V("Возникла ошибка при создании скидки!")}},ge=async(s,m)=>{try{return(await U.put(`https://api.dom-ban-na-drovah.ru/api/adminAccount/${g}/discounts/${s}`,m,{headers:{Authorization:`Bearer ${v}`}})).data}catch{V("Возникла ошибка при обновлении скидки!")}},Ne=async s=>{s.preventDefault();const m={description:i,discountType:t,applicableDays:A==="time_limit"?M:[],validFrom:F,validTill:c,timeDiscountType:A,discountPercentage:t==="discount"?parseFloat(u):null,applicableServices:Object.keys(z).filter(h=>{var y;return(y=z[h])==null?void 0:y.selected}),servicePrices:t==="discount_service"?S:{},freeServiceCounts:t==="free"?f:{},minServiceCounts:t==="free"?$:{}};try{a.id?(await ge(a.id,m),T("Акция успешно обновлена!")):(await ve(m),T("Акция успешно добавлена!")),D(),T(""),oe()}catch{V("Ошибка при добавлении или обновлении скидки. Попробуйте позже.")}},oe=()=>{p(""),K([]),J(""),N(""),k(0),_([]),n({broom:150,towel:200,hat:50,sheets:200}),j({broom:0,towel:0,hat:0,sheets:0}),C({broom:0,towel:0,hat:0,sheets:0}),r(null)},Y=G.getFullYear(),H=G.getMonth(),ye=new Date(Y,H,1),_e=Array.from({length:new Date(Y,H+1,0).getDate()},(s,m)=>new Date(Y,H,m+1)),de=new Date;de.setHours(0,0,0,0);const De=(ye.getDay()+6)%7,we=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],ae=[];for(let s=0;s<De;s++)ae.push(e.jsx("div",{className:"empty-cell"},`empty-${s}`));_e.forEach(s=>{const m=ce(s),h=s<de,y=M.includes(m),me=d.some(Ce=>Ce.applicable_days.includes(m));let ne="calendar_day";h&&(ne+=" past"),y&&(ne+=" selected"),me&&(ne+=" discounted"),ae.push(e.jsx("div",{className:ne,onClick:()=>!h&&be(s),children:s.getDate()},`day-${m}`))});const Se=(7-new Date(Y,H+1,0).getDay())%7;for(let s=0;s<Se;s++)ae.push(e.jsx("div",{},`empty-after-${s}`));const $e=i&&t&&F&&c&&((t==="discount"?u:!0)||(t==="discount_service"?Object.values(S).some(s=>s>0):!0)&&(t==="free"?Object.values(f).some(s=>s>0):!0)),ke=!i&&!F&&!c&&(!u||!Object.values(S).some(s=>s>0)||!Object.values(f).some(s=>s>0)),Ae=s=>({broom:150,towel:200,hat:50,sheets:200})[s]||0;return e.jsxs("div",{className:"account-form",children:[(q||B)&&e.jsx("p",{className:`auth-message ${B?"error":"success"} ${te?"fade-in":"fade-out"}`,role:"alert",children:q||B}),e.jsxs("form",{onSubmit:Ne,children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Описание акции:"}),e.jsx("textarea",{value:i,onChange:s=>p(s.target.value),required:!0})]}),e.jsx("div",{className:"discount-label",children:e.jsxs("label",{className:"form-label",children:[e.jsx("span",{className:"text-secondary",children:"Тип акции по длительности: "}),e.jsx("button",{type:"button",className:`mode-btn ${A==="no_time_limit"?"selected":""}`,onClick:()=>O("no_time_limit"),children:"неограниченная акция"}),e.jsx("span",{className:"text-secondary",children:" / "}),e.jsx("button",{type:"button",className:`mode-btn ${A==="time_limit"?"selected":""}`,onClick:()=>O("time_limit"),children:"ограниченная акция"})]})}),e.jsxs("div",{className:"form-wrapper",children:[A==="time_limit"&&e.jsx("div",{className:"calendar-container",children:e.jsxs("div",{className:"calendar_container",children:[e.jsxs("div",{className:"calendar_header",children:[e.jsx("button",{onClick:()=>Q(new Date(Y,H-1,1)),type:"button",className:"arrow-button",children:e.jsx(R,{icon:xe})})," ",e.jsx("span",{children:`${we[H]} ${Y}`}),e.jsx("button",{onClick:()=>Q(new Date(Y,H+1,1)),type:"button",className:"arrow-button",children:e.jsx(R,{icon:je})})]}),e.jsxs("div",{className:"calendar",children:[["ПН","ВТ","СР","ЧТ","ПТ","СБ","ВС"].map((s,m)=>e.jsx("div",{style:{textAlign:"center",fontWeight:"bold"},children:s},m)),ae]})]})}),e.jsxs("div",{className:`time-controls ${A!=="time_limit"?"align-left":""}`,children:[e.jsxs("label",{htmlFor:"startTime",className:"form-label",children:["Время начала:",e.jsx(ie,{id:"startTime",value:F?{value:F,label:F}:null,onChange:s=>J(s.value),options:w,classNamePrefix:"time-select",placeholder:"Выберите время",isDisabled:w.length===0,required:!0})]}),e.jsx("br",{}),e.jsxs("label",{htmlFor:"endTime",className:"form-label",children:["Время окончания:",e.jsx(ie,{id:"endTime",value:c?{value:c,label:c}:null,onChange:s=>N(s.value),options:L,classNamePrefix:"time-select",placeholder:"Выберите время",isDisabled:L.length===0,required:!0})]})]})]}),e.jsx("div",{className:"discount-label",children:e.jsxs("label",{className:"form-label",children:[e.jsx("span",{className:"text-secondary",children:"Тип скидки: "}),e.jsx("button",{type:"button",className:`mode-btn ${t==="discount"?"selected":""}`,onClick:()=>b("discount"),children:"скидка на стоимость"}),e.jsx("span",{className:"text-secondary",children:" / "}),e.jsx("button",{type:"button",className:`mode-btn ${t==="discount_service"?"selected":""}`,onClick:()=>b("discount_service"),children:"скидка на доп. услугу"}),e.jsx("span",{className:"text-secondary",children:" / "}),e.jsx("button",{type:"button",className:`mode-btn ${t==="free"?"selected":""}`,onClick:()=>b("free"),children:"бесплатные услуги"})]})}),e.jsx("div",{className:"discount-container",children:e.jsxs("div",{className:"additional-services",children:[t==="discount"&&e.jsx("div",{children:e.jsxs("label",{className:"service-item perсentage-discount",children:[e.jsx("span",{children:"Процент скидки:"}),e.jsx("div",{className:"service-quantity",children:e.jsx("input",{type:"number",value:u,onChange:s=>k(s.target.value),min:"0",max:"100",required:!0,className:"service-quantity-input"})})]})}),t&&t!=="discount"&&e.jsx(e.Fragment,{children:["broom","towel","hat","sheets"].map(s=>e.jsxs("div",{children:[t==="discount_service"&&e.jsxs("label",{className:"service-item",children:[e.jsxs("span",{children:[s==="broom"?"Веник":s==="towel"?"Полотенце":s==="hat"?"Шапка":"Простыня","(изначальная цена ",Ae(s)," ₽)"]}),e.jsx("div",{className:"service-quantity",children:e.jsx("input",{min:"0",type:"number",value:S[s]||"",onChange:m=>se(s,m.target.value),className:"service-quantity-input"})})]}),t==="free"&&e.jsx("label",{className:"service-item",children:e.jsxs("div",{className:"free-service-item",children:[e.jsx("span",{children:s==="broom"?"Веник":s==="towel"?"Полотенце":s==="hat"?"Шапка":"Простыня"}),e.jsxs("div",{className:"free-service-quantity",children:[e.jsx("label",{children:"Минимальное количество для бесплатной услуги:"}),e.jsx("div",{className:"service-quantity",children:e.jsx("input",{type:"number",value:$[s]||"",onChange:m=>pe(s,m.target.value),className:"service-quantity-input",min:"0",step:"1"})})]}),e.jsxs("div",{className:"free-service-quantity",children:[e.jsx("label",{children:"Количество бесплатных услуг:"}),e.jsx("div",{className:"service-quantity",children:e.jsx("input",{type:"number",value:f[s]||"",onChange:m=>fe(s,m.target.value),className:"service-quantity-input",min:"0",step:"1"})})]})]})})]},s))})]})}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:!$e,className:"form-button",children:a.id?"Сохранить изменения":"Добавить акцию"})}),!ke&&e.jsx("div",{children:e.jsx("p",{className:"auth-cancel",onClick:oe,children:"Отменить изменения"})})]})]})}const Je=({userId:d})=>e.jsx("footer",{className:"main-footer",children:e.jsxs("div",{className:"footer-container",children:[e.jsx("div",{className:"footer-section",children:e.jsx(P,{to:"/",className:"footer-title","aria-label":"На главную",children:"ДомБан"})}),e.jsxs("div",{className:"footer-section",children:[e.jsx("h4",{className:"footer-subtitle",children:"Навигация"}),e.jsx("nav",{"aria-label":"Дополнительная навигация",children:e.jsxs("ul",{className:"footer-links",children:[e.jsx("li",{children:e.jsx(P,{to:`/adminAccount/${d}/intervals`,className:"footer-link","aria-current":({isActive:r})=>r?"page":null,children:"Интервалы"})}),e.jsx("li",{children:e.jsx(P,{to:`/adminAccount/${d}/bookings/upcoming`,className:"footer-link","aria-current":({isActive:r})=>r?"page":null,children:"Бронирования"})}),e.jsx("li",{children:e.jsx(P,{to:`/adminAccount/${d}/discountsManager/new-discount`,className:"footer-link","aria-current":({isActive:r})=>r?"page":null,children:"Акции"})}),e.jsx("li",{children:e.jsx(P,{to:`/adminAccount/${d}/editProfile`,className:"footer-link","aria-current":({isActive:r})=>r?"page":null,children:"Профиль"})})]})})]}),e.jsxs("div",{className:"footer-section",children:[e.jsx("h4",{className:"footer-subtitle",children:"Контакты"}),e.jsxs("ul",{className:"footer-contacts",children:[e.jsx("li",{children:e.jsx("a",{href:"tel:+79036547447",className:"footer-link",children:"+7 (903) 654-74-47"})}),e.jsx("li",{children:e.jsx("a",{href:"mailto:info@domban.ru",className:"footer-link",children:"9036547447@mail.ru"})}),e.jsx("li",{className:"footer-address",children:"г. Воронеж, ул. Егорова д. 10"})]})]})]})});function st(){const d=ue(),[r,D]=l.useState({firstName:W.get("firstName"),lastName:W.get("lastName"),userId:W.get("userId"),token:W.get("token")});l.useEffect(()=>{W.get("token")||d("/")},[d]);const g=v=>{D(o=>({...o,firstName:v.first_name,lastName:v.last_name,phoneNumber:v.phone_number})),W.set("firstName",v.first_name,{expires:7,secure:!0,sameSite:"Strict"}),W.set("lastName",v.last_name,{expires:7,secure:!0,sameSite:"Strict"}),W.set("phoneNumber",v.phone_number,{expires:7,secure:!0,sameSite:"Strict"})};return e.jsxs("div",{"aria-labelledby":"page-title",children:[e.jsx(Ie,{userId:r.userId,"aria-label":"Навигация по аккаунту администратора"}),e.jsx("main",{className:"account-container",role:"region","aria-label":"Основное содержимое",children:e.jsxs(Oe,{children:[e.jsx(I,{path:"/",element:e.jsx(he,{to:`/adminAccount/${r.userId}/intervals`,replace:!0,"aria-label":"Перенаправление на страницу интервалов"})}),e.jsxs(I,{path:"intervals",element:e.jsx(Ee,{userId:r.userId,token:r.token,"aria-label":"Управление интервалами"}),children:[e.jsx(I,{index:!0,element:e.jsx(Le,{"aria-label":"Список доступных интервалов"})}),e.jsx(I,{path:"new-interval",element:e.jsx(Ue,{"aria-label":"Форма добавления нового интервала"})})]}),e.jsxs(I,{path:"bookings",element:e.jsx(Me,{userId:r.userId,token:r.token,"aria-label":"Управление бронированиями"}),children:[e.jsx(I,{path:"upcoming",element:e.jsx(qe,{"aria-label":"Предстоящие бронирования"})}),e.jsx(I,{path:"past",element:e.jsx(Be,{"aria-label":"Прошедшие бронирования"})})]}),e.jsxs(I,{path:"discountsManager",element:e.jsx(Fe,{userId:r.userId,token:r.token,"aria-label":"Управление скидками"}),children:[e.jsx(I,{path:"new-discount",element:e.jsx(We,{"aria-label":"Форма создания новой скидки"})}),e.jsx(I,{path:"discount-list",element:e.jsx(ze,{"aria-label":"Список скидок"})})]}),e.jsx(I,{path:"editProfile",element:e.jsx(Pe,{userId:r.userId,token:r.token,updateUserData:g,"aria-label":"Редактирование профиля"})}),e.jsx(I,{path:"*",element:e.jsx(he,{to:`/adminAccount/${r.userId}/intervals`,replace:!0,"aria-label":"Перенаправление на страницу по умолчанию"})})]})}),e.jsx(Je,{userId:r.userId})]})}export{st as default};
